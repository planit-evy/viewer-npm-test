import{r as p}from"./iframe-BYiykiDR.js";var R={exports:{}},y={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var x;function G(){if(x)return y;x=1;var s=Symbol.for("react.transitional.element"),c=Symbol.for("react.fragment");function m(w,n,t){var a=null;if(t!==void 0&&(a=""+t),n.key!==void 0&&(a=""+n.key),"key"in n){t={};for(var i in n)i!=="key"&&(t[i]=n[i])}else t=n;return n=t.ref,{$$typeof:s,type:w,key:a,ref:n!==void 0?n:null,props:t}}return y.Fragment=c,y.jsx=m,y.jsxs=m,y}var A;function j(){return A||(A=1,R.exports=G()),R.exports}var N=j();const W=async(s,c,m)=>{var E;const w=m||s.getRoot().getDefaultGeometry();await s.downloadAecModelData();const n=w.getAecModelData(),t=n&&n.refPointTransformation;let a=(E=c.model)==null?void 0:E.getData().globalOffset;const i=t?new THREE.Vector3(t[9],t[10],t[11]):new THREE.Vector3(0,0,0),V=4e6,v=a&&THREE.Vector3.prototype.distanceToSquared.call(i,a);return(!a||v>V)&&(a=new THREE.Vector3().copy(i)),a},M=({urn:s,accessToken:c,viewableId:m,useSharedCoordinateSystem:w,mappingCallback:n,clearCallback:t})=>{const a=p.useRef(null),i=p.useRef(null);if(typeof window>"u")return null;const V=(e,g)=>{let r=0;const o=[];let l=e.model.getData().instanceTree;function u(d){r++,l.getChildCount(d)!=0?l.enumNodeChildren(d,function(f){u(f)},!1):o.push(d),--r==0&&g(o)}e.getObjectTree(function(d){l=d,u(l.getRootId())})},v=p.useCallback(e=>{console.log("Geometry loaded",e)},[]),E=p.useCallback(e=>{console.log("Model added",e)},[]),T=p.useCallback(async e=>{V(e.target,function(g){console.log("Found "+g.length+" leaf nodes"),e.target.model.getBulkProperties2(g,{propFilter:["externalId"],categoryFilter:void 0,ignoreHidden:!0,needExternalId:!0},r=>{const o={};r.forEach(u=>{u.externalId&&(o[u.externalId]=u.dbId)}),console.log("Found leaf dbids processed");const l={model:e.model,guidsToDbids:o};console.log({model:e.model,guidsToDbids:o}),n&&n(l)},r=>{console.log("Mapping GUID to DBID error",r)})})},[]);return p.useEffect(()=>{if(typeof window>"u"||i.current||!a.current)return;async function e(r,o,l){const u=`urn:${r}`;Autodesk.Viewing.Document.load(u,async d=>{const f=d.getRoot(),J=f.findByGuid(m),C=f.getNamedViews().find(k=>k.data.name==="Default View"),I=f.getNamedViews().find(k=>k.data.name==="New Construction"),L=f.getDefaultGeometry(),h=J||C||I||L,F=await W(d,l,h);await l.loadDocumentNode(d,h,{applyRefPoint:w,keepCurrentModels:!o,globalOffset:w?F:{x:0,y:0,z:0}})},(d,f)=>{console.error(`Failed to load document ${r}`,d,f)})}async function g(){await Z();const r={env:"AutodeskProduction",accessToken:c};Autodesk.Viewing.Initializer(r,()=>{const o=new Autodesk.Viewing.GuiViewer3D(a.current);o.start(),i.current=o,(Array.isArray(s)?s:[s]).forEach((u,d)=>e(u,d===0,o))})}return g().then(()=>console.log("viewer loaded")),()=>{var r,o;(r=i.current)==null||r.tearDown(),(o=i.current)==null||o.finish(),i.current=null}},[s,c]),p.useEffect(()=>{const e=i.current;if(e)return e.addEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,v),e.addEventListener(Autodesk.Viewing.MODEL_ADDED_EVENT,E),e.addEventListener(Autodesk.Viewing.OBJECT_TREE_CREATED_EVENT,T),()=>{e.removeEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,v),e.removeEventListener(Autodesk.Viewing.MODEL_ADDED_EVENT,E),e.removeEventListener(Autodesk.Viewing.OBJECT_TREE_CREATED_EVENT,T),t==null||t()}},[v,E,T,t]),N.jsx("div",{ref:a,style:{width:"100%",height:"100%"}})};async function Z(){if(window.Autodesk)return;const s=document.createElement("script");s.src="https://developer.api.autodesk.com/modelderivative/v2/viewers/7.109.0/viewer3D.min.js",document.head.appendChild(s);const c=document.createElement("link");c.href="https://developer.api.autodesk.com/modelderivative/v2/viewers/7.109.0/style.min.css",c.rel="stylesheet",document.head.appendChild(c),await new Promise(m=>{s.onload=m})}M.__docgenInfo={description:"",methods:[],displayName:"AutodeskViewer",props:{urn:{required:!0,tsType:{name:"union",raw:"string | string[]",elements:[{name:"string"},{name:"Array",elements:[{name:"string"}],raw:"string[]"}]},description:"The URN of the model to load in Autodesk Viewer.\nExample: `dXJuOmFkc2subW9kZWw6...` or [`dXJuOmFkc2subW9kZWw6...`, `dXJuOmFkc2subW9kZWw6...`, etc]"},accessToken:{required:!0,tsType:{name:"string"},description:"The access token to use for authentication. Should be retrieved from your server."},viewableId:{required:!1,tsType:{name:"string"},description:`The ID of the viewable to load. If you don't provide this, the default viewable will be loaded'
View priority: selectedView > Default View > New Construction > Default Geometry(means Viewer method)`},useSharedCoordinateSystem:{required:!1,tsType:{name:"boolean"},description:`Whether to use a shared coordinate system for the model.
Default: false`},mappingCallback:{required:!1,tsType:{name:"signature",type:"function",raw:"(arg: any) => void",signature:{arguments:[{type:{name:"any"},name:"arg"}],return:{name:"void"}}},description:`Callback function to handle the mapping of GUIDs to DBIDs.
@param modelMapping - An object containing the model and its GUID-to-DBID mapping.`},clearCallback:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:`Callback function to clear any cached data or state.
Here I mean to clear all data that a user gets from any callback from viewer.`}}};const q={title:"Components/AutodeskViewer",component:M,parameters:{layout:"fullscreen"}},D={args:{urn:["dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLnRMT20wUTMxUmVpcWRXS3lsWUVfcHc_dmVyc2lvbj0yMA","dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLnVQb1lPaGZZVDJtRjRJcHVvS0xwTkE_dmVyc2lvbj0y"],accessToken:""}};var _,b,O;D.parameters={...D.parameters,docs:{...(_=D.parameters)==null?void 0:_.docs,source:{originalSource:`{
  args: {
    urn: ['dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLnRMT20wUTMxUmVpcWRXS3lsWUVfcHc_dmVyc2lvbj0yMA', 'dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLnVQb1lPaGZZVDJtRjRJcHVvS0xwTkE_dmVyc2lvbj0y'],
    accessToken: ''
  }
}`,...(O=(b=D.parameters)==null?void 0:b.docs)==null?void 0:O.source}}};const P=["Default"];export{D as Default,P as __namedExportsOrder,q as default};
