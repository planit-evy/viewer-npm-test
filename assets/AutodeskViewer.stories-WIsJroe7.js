import{r as y}from"./iframe-CUgFqwJq.js";var R={exports:{}},D={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var A;function j(){if(A)return D;A=1;var o=Symbol.for("react.transitional.element"),s=Symbol.for("react.fragment");function i(f,t,n){var r=null;if(n!==void 0&&(r=""+n),t.key!==void 0&&(r=""+t.key),"key"in t){n={};for(var l in t)l!=="key"&&(n[l]=t[l])}else n=t;return t=n.ref,{$$typeof:o,type:f,key:r,ref:t!==void 0?t:null,props:n}}return D.Fragment=s,D.jsx=i,D.jsxs=i,D}var b;function N(){return b||(b=1,R.exports=j()),R.exports}var W=N();const Z=async(o,s,i)=>{var E;const f=i||o.getRoot().getDefaultGeometry();await o.downloadAecModelData();const t=f.getAecModelData(),n=t&&t.refPointTransformation;let r=(E=s.model)==null?void 0:E.getData().globalOffset;const l=n?new THREE.Vector3(n[9],n[10],n[11]):new THREE.Vector3(0,0,0),V=4e6,k=r&&THREE.Vector3.prototype.distanceToSquared.call(l,r);return(!r||k>V)&&(r=new THREE.Vector3().copy(l)),r},M=({urn:o,accessToken:s,viewableId:i,useSharedCoordinateSystem:f,mappingCallback:t,clearCallback:n})=>{const r=y.useRef(null);if(typeof window>"u")return null;const l=(e,p)=>{let c=0;const u=[];let m=e.model.getData().instanceTree;function a(d){c++,m.getChildCount(d)!=0?m.enumNodeChildren(d,function(v){a(v)},!1):u.push(d),--c==0&&p(u)}e.getObjectTree(function(d){m=d,a(m.getRootId())})},V=y.useCallback(e=>{console.log("Geometry loaded",e)},[]),k=y.useCallback(e=>{console.log("Model added",e)},[]),E=y.useCallback(async e=>{l(e.target,function(p){console.log("Found "+p.length+" leaf nodes"),e.target.model.getBulkProperties2(p,{propFilter:["externalId"],categoryFilter:void 0,ignoreHidden:!0,needExternalId:!0},c=>{const u={};c.forEach(a=>{a.externalId&&(u[a.externalId]=a.dbId)}),console.log("Found leaf dbids processed");const m={model:e.model,guidsToDbids:u};console.log({model:e.model,guidsToDbids:u}),t&&t(m)},c=>{console.log("Mapping GUID to DBID error",c)})})},[]);return y.useEffect(()=>{if(typeof window>"u")return;let e;async function p(){await H();const c={env:"AutodeskProduction",accessToken:s};Autodesk.Viewing.Initializer(c,()=>{if(e!=null&&e.running)return;e=new Autodesk.Viewing.GuiViewer3D(r.current),e.start();const u=Array.isArray(o)?o:[o],m=async(a,d)=>{const v=`urn:${a}`;Autodesk.Viewing.Document.load(v,async w=>{const g=w.getRoot(),J=g.findByGuid(i),I=g.getNamedViews().find(h=>h.data.name==="Default View"),L=g.getNamedViews().find(h=>h.data.name==="New Construction"),F=g.getDefaultGeometry(),x=J||I||L||F,G=await Z(w,e,x);await e.loadDocumentNode(w,x,{applyRefPoint:f,keepCurrentModels:!d,globalOffset:f?G:{x:0,y:0,z:0}})},(w,g)=>{console.error(`Failed to load document ${a}`,w,g)})};u.forEach((a,d)=>m(a,d===0)),e.addEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,V),e.addEventListener(Autodesk.Viewing.MODEL_ADDED_EVENT,k),e.addEventListener(Autodesk.Viewing.OBJECT_TREE_CREATED_EVENT,E)})}return p().then(()=>console.log("viewer loaded")),()=>{e&&(e==null||e.tearDown(),e==null||e.finish(),e==null||e.removeEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,V),e==null||e.removeEventListener(Autodesk.Viewing.MODEL_ADDED_EVENT,k),e==null||e.removeEventListener(Autodesk.Viewing.OBJECT_TREE_CREATED_EVENT,E),n&&n())}},[o,s]),W.jsx("div",{ref:r,style:{width:"100%",height:"100%"}})};async function H(){if(window.Autodesk)return;const o=document.createElement("script");o.src="https://developer.api.autodesk.com/modelderivative/v2/viewers/7.109.0/viewer3D.min.js",document.head.appendChild(o);const s=document.createElement("link");s.href="https://developer.api.autodesk.com/modelderivative/v2/viewers/7.109.0/style.min.css",s.rel="stylesheet",document.head.appendChild(s),await new Promise(i=>{o.onload=i})}M.__docgenInfo={description:"",methods:[],displayName:"AutodeskViewer",props:{urn:{required:!0,tsType:{name:"union",raw:"string | string[]",elements:[{name:"string"},{name:"Array",elements:[{name:"string"}],raw:"string[]"}]},description:"The URN of the model to load in Autodesk Viewer.\nExample: `dXJuOmFkc2subW9kZWw6...` or [`dXJuOmFkc2subW9kZWw6...`, `dXJuOmFkc2subW9kZWw6...`, etc]"},accessToken:{required:!0,tsType:{name:"string"},description:"The access token to use for authentication. Should be retrieved from your server."},viewableId:{required:!1,tsType:{name:"string"},description:`The ID of the viewable to load. If you don't provide this, the default viewable will be loaded'
View priority: selectedView > Default View > New Construction > Default Geometry(means Viewer method)`},useSharedCoordinateSystem:{required:!1,tsType:{name:"boolean"},description:`Whether to use a shared coordinate system for the model.
Default: false`},mappingCallback:{required:!1,tsType:{name:"signature",type:"function",raw:"(arg: any) => void",signature:{arguments:[{type:{name:"any"},name:"arg"}],return:{name:"void"}}},description:`Callback function to handle the mapping of GUIDs to DBIDs.
@param modelMapping - An object containing the model and its GUID-to-DBID mapping.`},clearCallback:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:`Callback function to clear any cached data or state.
Here I mean to clear all data that a user gets from any callback from viewer.`}}};const P={title:"Components/AutodeskViewer",component:M,parameters:{layout:"fullscreen"}},T={args:{urn:["dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLnRMT20wUTMxUmVpcWRXS3lsWUVfcHc_dmVyc2lvbj0yMA","dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLnVQb1lPaGZZVDJtRjRJcHVvS0xwTkE_dmVyc2lvbj0y"],accessToken:""}};var _,O,C;T.parameters={...T.parameters,docs:{...(_=T.parameters)==null?void 0:_.docs,source:{originalSource:`{
  args: {
    urn: ['dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLnRMT20wUTMxUmVpcWRXS3lsWUVfcHc_dmVyc2lvbj0yMA', 'dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLnVQb1lPaGZZVDJtRjRJcHVvS0xwTkE_dmVyc2lvbj0y'],
    accessToken: ''
  }
}`,...(C=(O=T.parameters)==null?void 0:O.docs)==null?void 0:C.source}}};const S=["Default"];export{T as Default,S as __namedExportsOrder,P as default};
