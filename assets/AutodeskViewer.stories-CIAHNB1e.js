import{r as v}from"./iframe-P7OTMGRp.js";var O={exports:{}},k={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var C;function U(){if(C)return k;C=1;var r=Symbol.for("react.transitional.element"),a=Symbol.for("react.fragment");function i(m,e,n){var d=null;if(n!==void 0&&(d=""+n),e.key!==void 0&&(d=""+e.key),"key"in e){n={};for(var p in e)p!=="key"&&(n[p]=e[p])}else n=e;return e=n.ref,{$$typeof:r,type:m,key:d,ref:e!==void 0?e:null,props:n}}return k.Fragment=a,k.jsx=i,k.jsxs=i,k}var P;function B(){return P||(P=1,O.exports=U()),O.exports}var I=B();const X=async(r,a,i)=>{var E;const m=i||r.getRoot().getDefaultGeometry();await r.downloadAecModelData();const e=m.getAecModelData(),n=e&&e.refPointTransformation;let d=(E=a.model)==null?void 0:E.getData().globalOffset;const p=n?new THREE.Vector3(n[9],n[10],n[11]):new THREE.Vector3(0,0,0),D=4e6,T=d&&THREE.Vector3.prototype.distanceToSquared.call(p,d);return(!d||T>D)&&(d=new THREE.Vector3().copy(p)),d},L=({urn:r,accessToken:a,viewableId:i,useSharedCoordinateSystem:m,mappingCallback:e,clearCallback:n,viewerEnv:d="AutodeskProduction2",viewerApi:p="derivativeV2",theme:D="light-theme",version:T="7.111.0"})=>{const E=v.useRef(null),o=v.useRef(null);if(typeof window>"u")return null;const j=(t,l)=>{let s=0;const u=[];let c=t.model.getData().instanceTree;function f(w){s++,c.getChildCount(w)!=0?c.enumNodeChildren(w,function(g){f(g)},!1):u.push(w),--s==0&&l(u)}t.getObjectTree(function(w){c=w,f(c.getRootId())})},R=v.useCallback(t=>{console.log("Geometry loaded",t)},[]),A=v.useCallback(t=>{console.log("Model added",t)},[]),x=v.useCallback(async t=>{j(t.target,function(l){console.log("Found "+l.length+" leaf nodes"),t.target.model.getBulkProperties2(l,{propFilter:["externalId"],categoryFilter:void 0,ignoreHidden:!0,needExternalId:!0},s=>{const u={};s.forEach(f=>{f.externalId&&(u[f.externalId]=f.dbId)}),console.log("Found leaf dbids processed");const c={model:t.model,guidsToDbids:u};console.log({model:t.model,guidsToDbids:u}),e&&e(c)},s=>{console.log("Mapping GUID to DBID error",s)})})},[]);return v.useEffect(()=>{if(!o.current){async function t(){await $(T);const l={env:d,api:p,accessToken:a},s={extensions:["Autodesk.DocumentBrowser"],theme:D};Autodesk.Viewing.Initializer(l,()=>{var f,w;(f=window==null?void 0:window.NOP_VIEWER)==null||f.finish(),(w=window==null?void 0:window.NOP_VIEWER)==null||w.tearDown(),o.current=new Autodesk.Viewing.GuiViewer3D(E.current,s),o.current.start();const u=Array.isArray(r)?r:[r],c=async(g,_)=>{const q=`urn:${g}`;Autodesk.Viewing.Document.load(q,async h=>{const V=h.getRoot(),F=V.findByGuid(i),G=V.getNamedViews().find(b=>b.data.name==="Default View"),Z=V.getNamedViews().find(b=>b.data.name==="New Construction"),H=V.getDefaultGeometry(),M=F||G||Z||H,S=await X(h,o.current,M);await o.current.loadDocumentNode(h,M,{applyRefPoint:m,keepCurrentModels:!_,globalOffset:m?S:{x:0,y:0,z:0}})},(h,V)=>{console.error(`Failed to load document ${g}`,h,V)})};u.forEach((g,_)=>c(g,_===0)),o.current.addEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,R),o.current.addEventListener(Autodesk.Viewing.MODEL_ADDED_EVENT,A),o.current.addEventListener(Autodesk.Viewing.OBJECT_TREE_CREATED_EVENT,x)})}t().then(()=>console.log("VIEWER LOADED",o.current,window==null?void 0:window.NOP_VIEWERS))}return()=>{var t,l,s,u,c;(t=o.current)==null||t.tearDown(),(l=o.current)==null||l.finish(),(s=o.current)==null||s.removeEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,R),(u=o.current)==null||u.removeEventListener(Autodesk.Viewing.MODEL_ADDED_EVENT,A),(c=o.current)==null||c.removeEventListener(Autodesk.Viewing.OBJECT_TREE_CREATED_EVENT,x),o.current=null,n&&n()}},[r,a,R,A,x,n]),v.useEffect(()=>{if(!E.current)return;const t=new ResizeObserver(l=>{for(const s of l)window!=null&&window.NOP_VIEWER&&window.NOP_VIEWER.resize()});return t.observe(E.current),()=>{t.disconnect()}},[]),I.jsx("div",{ref:E,style:{width:"100%",height:"100%"}})};async function $(r){var m;if((m=window.Autodesk)!=null&&m.Viewing)return;if(document.getElementById("forge-viewer-script")){await new Promise(e=>{document.getElementById("forge-viewer-script").onload=e});return}const a=document.createElement("script");a.id="forge-viewer-script",a.src=`https://developer.api.autodesk.com/modelderivative/v2/viewers/${r}/viewer3D.min.js`,document.head.appendChild(a);const i=document.createElement("link");i.href=`https://developer.api.autodesk.com/modelderivative/v2/viewers/${r}/style.min.css`,i.rel="stylesheet",document.head.appendChild(i),await new Promise(e=>{a.onload=e})}L.__docgenInfo={description:"",methods:[],displayName:"AutodeskViewer",props:{urn:{required:!0,tsType:{name:"union",raw:"string | string[]",elements:[{name:"string"},{name:"Array",elements:[{name:"string"}],raw:"string[]"}]},description:"The URN of the model to load in Autodesk Viewer.\nExample: `dXJuOmFkc2subW9kZWw6...` or [`dXJuOmFkc2subW9kZWw6...`, `dXJuOmFkc2subW9kZWw6...`, etc.]"},accessToken:{required:!0,tsType:{name:"string"},description:"The access token to use for authentication. Should be retrieved from your server."},viewableId:{required:!1,tsType:{name:"string"},description:`The ID of the viewable to load. If you don't provide this, the default viewable will be loaded'
View priority: selectedView > Default View > New Construction > Default Geometry (means Viewer method)`},useSharedCoordinateSystem:{required:!1,tsType:{name:"boolean"},description:`Whether to use a shared coordinate system for the model.
Default: false`},mappingCallback:{required:!1,tsType:{name:"signature",type:"function",raw:"(arg: any) => void",signature:{arguments:[{type:{name:"any"},name:"arg"}],return:{name:"void"}}},description:`Callback function to handle the mapping of GUIDs to DBIDs.
@param modelMapping - An object containing the model and its GUID-to-DBID mapping.`},clearCallback:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:`Callback function to clear any cached data or state.
Here I mean to clear all data that a user gets from any callback from viewer.`},viewerEnv:{required:!1,tsType:{name:"union",raw:"'AutodeskProduction' | 'AutodeskProduction2'",elements:[{name:"literal",value:"'AutodeskProduction'"},{name:"literal",value:"'AutodeskProduction2'"}]},description:`The environment to use for Autodesk Viewer.
Default: 'AutodeskProduction2'`,defaultValue:{value:"'AutodeskProduction2'",computed:!1}},viewerApi:{required:!1,tsType:{name:"union",raw:"'streamingV2' | 'derivativeV2'",elements:[{name:"literal",value:"'streamingV2'"},{name:"literal",value:"'derivativeV2'"}]},description:`The API to use for Autodesk Viewer.
Default: 'derivativeV2'`,defaultValue:{value:"'derivativeV2'",computed:!1}},theme:{required:!1,tsType:{name:"union",raw:"'light-theme' | 'dark-theme'",elements:[{name:"literal",value:"'light-theme'"},{name:"literal",value:"'dark-theme'"}]},description:`The theme to use for Autodesk Viewer.
Default: 'light-theme'`,defaultValue:{value:"'light-theme'",computed:!1}},version:{required:!1,tsType:{name:"string"},description:`The version of Autodesk Viewer to use.
Default: '7.111.0'
The latest updates could be checked here: https://aps.autodesk.com/en/docs/viewer/v7/change_history/changelog_v7/`,defaultValue:{value:"'7.111.0'",computed:!1}}}};const Y={title:"Components/AutodeskViewer",component:L,parameters:{layout:"fullscreen"},decorators:[r=>I.jsx(v.StrictMode,{children:I.jsx(r,{})})]},y={args:{urn:["dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLnRMT20wUTMxUmVpcWRXS3lsWUVfcHc_dmVyc2lvbj0yMA","dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLnVQb1lPaGZZVDJtRjRJcHVvS0xwTkE_dmVyc2lvbj0y"],accessToken:""}};var J,W,N;y.parameters={...y.parameters,docs:{...(J=y.parameters)==null?void 0:J.docs,source:{originalSource:`{
  args: {
    urn: ['dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLnRMT20wUTMxUmVpcWRXS3lsWUVfcHc_dmVyc2lvbj0yMA', 'dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLnVQb1lPaGZZVDJtRjRJcHVvS0xwTkE_dmVyc2lvbj0y'],
    accessToken: ''
  }
}`,...(N=(W=y.parameters)==null?void 0:W.docs)==null?void 0:N.source}}};const Q=["Default"];export{y as Default,Q as __namedExportsOrder,Y as default};
