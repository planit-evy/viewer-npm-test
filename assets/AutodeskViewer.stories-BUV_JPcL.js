import{r as v}from"./iframe-CNVNHe-V.js";var h={exports:{}},D={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var A;function j(){if(A)return D;A=1;var r=Symbol.for("react.transitional.element"),l=Symbol.for("react.fragment");function u(w,n,t){var s=null;if(t!==void 0&&(s=""+t),n.key!==void 0&&(s=""+n.key),"key"in n){t={};for(var e in n)e!=="key"&&(t[e]=n[e])}else t=n;return n=t.ref,{$$typeof:r,type:w,key:s,ref:n!==void 0?n:null,props:t}}return D.Fragment=l,D.jsx=u,D.jsxs=u,D}var b;function N(){return b||(b=1,h.exports=j()),h.exports}var W=N();const Z=async(r,l,u)=>{var E;const w=u||r.getRoot().getDefaultGeometry();await r.downloadAecModelData();const n=w.getAecModelData(),t=n&&n.refPointTransformation;let s=(E=l.model)==null?void 0:E.getData().globalOffset;const e=t?new THREE.Vector3(t[9],t[10],t[11]):new THREE.Vector3(0,0,0),T=4e6,y=s&&THREE.Vector3.prototype.distanceToSquared.call(e,s);return(!s||y>T)&&(s=new THREE.Vector3().copy(e)),s},M=({urn:r,accessToken:l,viewableId:u,useSharedCoordinateSystem:w,mappingCallback:n,clearCallback:t})=>{const s=v.useRef(null),e=v.useRef(null);if(typeof window>"u")return null;const T=(a,m)=>{let d=0;const c=[];let o=a.model.getData().instanceTree;function i(f){d++,o.getChildCount(f)!=0?o.enumNodeChildren(f,function(p){i(p)},!1):c.push(f),--d==0&&m(c)}a.getObjectTree(function(f){o=f,i(o.getRootId())})},y=v.useCallback(a=>{console.log("Geometry loaded",a)},[]),E=v.useCallback(a=>{console.log("Model added",a)},[]),k=v.useCallback(async a=>{T(a.target,function(m){console.log("Found "+m.length+" leaf nodes"),a.target.model.getBulkProperties2(m,{propFilter:["externalId"],categoryFilter:void 0,ignoreHidden:!0,needExternalId:!0},d=>{const c={};d.forEach(i=>{i.externalId&&(c[i.externalId]=i.dbId)}),console.log("Found leaf dbids processed");const o={model:a.model,guidsToDbids:c};console.log({model:a.model,guidsToDbids:c}),n&&n(o)},d=>{console.log("Mapping GUID to DBID error",d)})})},[]);return v.useEffect(()=>{if(typeof window>"u")return;async function a(){if(e.current)return;await H();const m={env:"AutodeskProduction",accessToken:l};Autodesk.Viewing.Initializer(m,()=>{e.current=new Autodesk.Viewing.GuiViewer3D(s.current),e.current.start();const d=Array.isArray(r)?r:[r],c=async(o,i)=>{const f=`urn:${o}`;Autodesk.Viewing.Document.load(f,async p=>{const g=p.getRoot(),J=g.findByGuid(u),I=g.getNamedViews().find(R=>R.data.name==="Default View"),L=g.getNamedViews().find(R=>R.data.name==="New Construction"),F=g.getDefaultGeometry(),x=J||I||L||F,G=await Z(p,e.current,x);await e.current.loadDocumentNode(p,x,{applyRefPoint:w,keepCurrentModels:!i,globalOffset:w?G:{x:0,y:0,z:0}})},(p,g)=>{console.error(`Failed to load document ${o}`,p,g)})};d.forEach((o,i)=>c(o,i===0)),e.current.addEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,y),e.current.addEventListener(Autodesk.Viewing.MODEL_ADDED_EVENT,E),e.current.addEventListener(Autodesk.Viewing.OBJECT_TREE_CREATED_EVENT,k)})}return!e.current&&s.current&&a().then(()=>console.log("viewer loaded")),()=>{var m,d,c,o,i;(m=e.current)==null||m.tearDown(),(d=e.current)==null||d.finish(),(c=e.current)==null||c.removeEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,y),(o=e.current)==null||o.removeEventListener(Autodesk.Viewing.MODEL_ADDED_EVENT,E),(i=e.current)==null||i.removeEventListener(Autodesk.Viewing.OBJECT_TREE_CREATED_EVENT,k),t&&t()}},[r,l,y,E,k,t]),W.jsx("div",{ref:s,style:{width:"100%",height:"100%"}})};async function H(){if(window.Autodesk)return;const r=document.createElement("script");r.src="https://developer.api.autodesk.com/modelderivative/v2/viewers/7.109.0/viewer3D.min.js",document.head.appendChild(r);const l=document.createElement("link");l.href="https://developer.api.autodesk.com/modelderivative/v2/viewers/7.109.0/style.min.css",l.rel="stylesheet",document.head.appendChild(l),await new Promise(u=>{r.onload=u})}M.__docgenInfo={description:"",methods:[],displayName:"AutodeskViewer",props:{urn:{required:!0,tsType:{name:"union",raw:"string | string[]",elements:[{name:"string"},{name:"Array",elements:[{name:"string"}],raw:"string[]"}]},description:"The URN of the model to load in Autodesk Viewer.\nExample: `dXJuOmFkc2subW9kZWw6...` or [`dXJuOmFkc2subW9kZWw6...`, `dXJuOmFkc2subW9kZWw6...`, etc]"},accessToken:{required:!0,tsType:{name:"string"},description:"The access token to use for authentication. Should be retrieved from your server."},viewableId:{required:!1,tsType:{name:"string"},description:`The ID of the viewable to load. If you don't provide this, the default viewable will be loaded'
View priority: selectedView > Default View > New Construction > Default Geometry(means Viewer method)`},useSharedCoordinateSystem:{required:!1,tsType:{name:"boolean"},description:`Whether to use a shared coordinate system for the model.
Default: false`},mappingCallback:{required:!1,tsType:{name:"signature",type:"function",raw:"(arg: any) => void",signature:{arguments:[{type:{name:"any"},name:"arg"}],return:{name:"void"}}},description:`Callback function to handle the mapping of GUIDs to DBIDs.
@param modelMapping - An object containing the model and its GUID-to-DBID mapping.`},clearCallback:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:`Callback function to clear any cached data or state.
Here I mean to clear all data that a user gets from any callback from viewer.`}}};const P={title:"Components/AutodeskViewer",component:M,parameters:{layout:"fullscreen"}},V={args:{urn:["dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLnRMT20wUTMxUmVpcWRXS3lsWUVfcHc_dmVyc2lvbj0yMA","dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLnVQb1lPaGZZVDJtRjRJcHVvS0xwTkE_dmVyc2lvbj0y"],accessToken:""}};var _,O,C;V.parameters={...V.parameters,docs:{...(_=V.parameters)==null?void 0:_.docs,source:{originalSource:`{
  args: {
    urn: ['dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLnRMT20wUTMxUmVpcWRXS3lsWUVfcHc_dmVyc2lvbj0yMA', 'dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLnVQb1lPaGZZVDJtRjRJcHVvS0xwTkE_dmVyc2lvbj0y'],
    accessToken: ''
  }
}`,...(C=(O=V.parameters)==null?void 0:O.docs)==null?void 0:C.source}}};const S=["Default"];export{V as Default,S as __namedExportsOrder,P as default};
