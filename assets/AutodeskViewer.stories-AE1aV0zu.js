import{r as w}from"./iframe-V_1LU_l0.js";var h={exports:{}},D={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var b;function G(){if(b)return D;b=1;var o=Symbol.for("react.transitional.element"),c=Symbol.for("react.fragment");function u(E,r,t){var a=null;if(t!==void 0&&(a=""+t),r.key!==void 0&&(a=""+r.key),"key"in r){t={};for(var e in r)e!=="key"&&(t[e]=r[e])}else t=r;return r=t.ref,{$$typeof:o,type:E,key:a,ref:r!==void 0?r:null,props:t}}return D.Fragment=c,D.jsx=u,D.jsxs=u,D}var _;function N(){return _||(_=1,h.exports=G()),h.exports}var x=N();const Z=async(o,c,u)=>{var g;const E=u||o.getRoot().getDefaultGeometry();await o.downloadAecModelData();const r=E.getAecModelData(),t=r&&r.refPointTransformation;let a=(g=c.model)==null?void 0:g.getData().globalOffset;const e=t?new THREE.Vector3(t[9],t[10],t[11]):new THREE.Vector3(0,0,0),T=4e6,y=a&&THREE.Vector3.prototype.distanceToSquared.call(e,a);return(!a||y>T)&&(a=new THREE.Vector3().copy(e)),a},J=({urn:o,accessToken:c,viewableId:u,useSharedCoordinateSystem:E,mappingCallback:r,clearCallback:t})=>{const a=w.useRef(null),e=w.useRef(null);if(typeof window>"u")return null;const T=(n,m)=>{let i=0;const d=[];let s=n.model.getData().instanceTree;function l(f){i++,s.getChildCount(f)!=0?s.enumNodeChildren(f,function(p){l(p)},!1):d.push(f),--i==0&&m(d)}n.getObjectTree(function(f){s=f,l(s.getRootId())})},y=w.useCallback(n=>{console.log("Geometry loaded",n)},[]),g=w.useCallback(n=>{console.log("Model added",n)},[]),k=w.useCallback(async n=>{T(n.target,function(m){console.log("Found "+m.length+" leaf nodes"),n.target.model.getBulkProperties2(m,{propFilter:["externalId"],categoryFilter:void 0,ignoreHidden:!0,needExternalId:!0},i=>{const d={};i.forEach(l=>{l.externalId&&(d[l.externalId]=l.dbId)}),console.log("Found leaf dbids processed");const s={model:n.model,guidsToDbids:d};console.log({model:n.model,guidsToDbids:d}),r&&r(s)},i=>{console.log("Mapping GUID to DBID error",i)})})},[]);return w.useEffect(()=>{if(!e.current){async function n(){await H();const m={env:"AutodeskProduction",accessToken:c};Autodesk.Viewing.Initializer(m,()=>{e.current=new Autodesk.Viewing.GuiViewer3D(a.current),e.current.start();const i=Array.isArray(o)?o:[o],d=async(s,l)=>{const f=`urn:${s}`;Autodesk.Viewing.Document.load(f,async p=>{const v=p.getRoot(),I=v.findByGuid(u),L=v.getNamedViews().find(R=>R.data.name==="Default View"),j=v.getNamedViews().find(R=>R.data.name==="New Construction"),W=v.getDefaultGeometry(),A=I||L||j||W,F=await Z(p,e.current,A);await e.current.loadDocumentNode(p,A,{applyRefPoint:E,keepCurrentModels:!l,globalOffset:E?F:{x:0,y:0,z:0}})},(p,v)=>{console.error(`Failed to load document ${s}`,p,v)})};i.forEach((s,l)=>d(s,l===0)),e.current.addEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,y),e.current.addEventListener(Autodesk.Viewing.MODEL_ADDED_EVENT,g),e.current.addEventListener(Autodesk.Viewing.OBJECT_TREE_CREATED_EVENT,k)})}n().then(()=>console.log("VIEWER LOADED",e.current,window==null?void 0:window.NOP_VIEWERS))}return()=>{var n,m,i,d,s;e.current&&((n=e.current)==null||n.tearDown(),(m=e.current)==null||m.finish(),(i=e.current)==null||i.removeEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,y),(d=e.current)==null||d.removeEventListener(Autodesk.Viewing.MODEL_ADDED_EVENT,g),(s=e.current)==null||s.removeEventListener(Autodesk.Viewing.OBJECT_TREE_CREATED_EVENT,k),e.current=null,t&&t())}},[o,c,y,g,k,t]),x.jsx("div",{ref:a,style:{width:"100%",height:"100%"}})};async function H(){if(window.Autodesk)return;const o=document.createElement("script");o.src="https://developer.api.autodesk.com/modelderivative/v2/viewers/7.109.0/viewer3D.min.js",document.head.appendChild(o);const c=document.createElement("link");c.href="https://developer.api.autodesk.com/modelderivative/v2/viewers/7.109.0/style.min.css",c.rel="stylesheet",document.head.appendChild(c),await new Promise(u=>{o.onload=u})}J.__docgenInfo={description:"",methods:[],displayName:"AutodeskViewer",props:{urn:{required:!0,tsType:{name:"union",raw:"string | string[]",elements:[{name:"string"},{name:"Array",elements:[{name:"string"}],raw:"string[]"}]},description:"The URN of the model to load in Autodesk Viewer.\nExample: `dXJuOmFkc2subW9kZWw6...` or [`dXJuOmFkc2subW9kZWw6...`, `dXJuOmFkc2subW9kZWw6...`, etc.]"},accessToken:{required:!0,tsType:{name:"string"},description:"The access token to use for authentication. Should be retrieved from your server."},viewableId:{required:!1,tsType:{name:"string"},description:`The ID of the viewable to load. If you don't provide this, the default viewable will be loaded'
View priority: selectedView > Default View > New Construction > Default Geometry (means Viewer method)`},useSharedCoordinateSystem:{required:!1,tsType:{name:"boolean"},description:`Whether to use a shared coordinate system for the model.
Default: false`},mappingCallback:{required:!1,tsType:{name:"signature",type:"function",raw:"(arg: any) => void",signature:{arguments:[{type:{name:"any"},name:"arg"}],return:{name:"void"}}},description:`Callback function to handle the mapping of GUIDs to DBIDs.
@param modelMapping - An object containing the model and its GUID-to-DBID mapping.`},clearCallback:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:`Callback function to clear any cached data or state.
Here I mean to clear all data that a user gets from any callback from viewer.`}}};const S={title:"Components/AutodeskViewer",component:J,parameters:{layout:"fullscreen"},decorators:[o=>x.jsx(w.StrictMode,{children:x.jsx(o,{})})]},V={args:{urn:["dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLnRMT20wUTMxUmVpcWRXS3lsWUVfcHc_dmVyc2lvbj0yMA","dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLnVQb1lPaGZZVDJtRjRJcHVvS0xwTkE_dmVyc2lvbj0y"],accessToken:""}};var O,M,C;V.parameters={...V.parameters,docs:{...(O=V.parameters)==null?void 0:O.docs,source:{originalSource:`{
  args: {
    urn: ['dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLnRMT20wUTMxUmVpcWRXS3lsWUVfcHc_dmVyc2lvbj0yMA', 'dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLnVQb1lPaGZZVDJtRjRJcHVvS0xwTkE_dmVyc2lvbj0y'],
    accessToken: ''
  }
}`,...(C=(M=V.parameters)==null?void 0:M.docs)==null?void 0:C.source}}};const P=["Default"];export{V as Default,P as __namedExportsOrder,S as default};
