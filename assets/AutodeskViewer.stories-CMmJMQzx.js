import{r as g}from"./iframe-Bd_Glu69.js";var _={exports:{}},D={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var O;function H(){if(O)return D;O=1;var o=Symbol.for("react.transitional.element"),l=Symbol.for("react.fragment");function u(p,n,t){var r=null;if(t!==void 0&&(r=""+t),n.key!==void 0&&(r=""+n.key),"key"in n){t={};for(var e in n)e!=="key"&&(t[e]=n[e])}else t=n;return n=t.ref,{$$typeof:o,type:p,key:r,ref:n!==void 0?n:null,props:t}}return D.Fragment=l,D.jsx=u,D.jsxs=u,D}var C;function P(){return C||(C=1,_.exports=H()),_.exports}var q=P();const S=async(o,l,u)=>{var w;const p=u||o.getRoot().getDefaultGeometry();await o.downloadAecModelData();const n=p.getAecModelData(),t=n&&n.refPointTransformation;let r=(w=l.model)==null?void 0:w.getData().globalOffset;const e=t?new THREE.Vector3(t[9],t[10],t[11]):new THREE.Vector3(0,0,0),R=4e6,v=r&&THREE.Vector3.prototype.distanceToSquared.call(e,r);return(!r||v>R)&&(r=new THREE.Vector3().copy(e)),r},L=({urn:o,accessToken:l,viewableId:u,useSharedCoordinateSystem:p,mappingCallback:n,clearCallback:t})=>{const r=g.useRef(null),e=g.useRef(null);if(typeof window>"u")return null;const R=(s,m)=>{let d=0;const c=[];let a=s.model.getData().instanceTree;function i(f){d++,a.getChildCount(f)!=0?a.enumNodeChildren(f,function(V){i(V)},!1):c.push(f),--d==0&&m(c)}s.getObjectTree(function(f){a=f,i(a.getRootId())})},v=g.useCallback(s=>{console.log("Geometry loaded",s)},[]),w=g.useCallback(s=>{console.log("Model added",s)},[]),h=g.useCallback(async s=>{R(s.target,function(m){console.log("Found "+m.length+" leaf nodes"),s.target.model.getBulkProperties2(m,{propFilter:["externalId"],categoryFilter:void 0,ignoreHidden:!0,needExternalId:!0},d=>{const c={};d.forEach(i=>{i.externalId&&(c[i.externalId]=i.dbId)}),console.log("Found leaf dbids processed");const a={model:s.model,guidsToDbids:c};console.log({model:s.model,guidsToDbids:c}),n&&n(a)},d=>{console.log("Mapping GUID to DBID error",d)})})},[]);return g.useEffect(()=>{async function s(){if(e.current)return;console.log("ref",e.current),await U();const m={env:"AutodeskProduction",accessToken:l};Autodesk.Viewing.Initializer(m,()=>{var a,i,f,V;(e.current||window!=null&&window.NOP_VIEWER)&&((a=e.current)==null||a.tearDown(),(i=e.current)==null||i.finish(),(f=window==null?void 0:window.NOP_VIEWER)==null||f.tearDown(),(V=window==null?void 0:window.NOP_VIEWER)==null||V.finish(),e.current=null),e.current=new Autodesk.Viewing.GuiViewer3D(r.current),e.current.start();const d=Array.isArray(o)?o:[o],c=async(T,x)=>{const N=`urn:${T}`;Autodesk.Viewing.Document.load(N,async y=>{const E=y.getRoot(),W=E.findByGuid(u),F=E.getNamedViews().find(A=>A.data.name==="Default View"),G=E.getNamedViews().find(A=>A.data.name==="New Construction"),j=E.getDefaultGeometry(),b=W||F||G||j,Z=await S(y,e.current,b);await e.current.loadDocumentNode(y,b,{applyRefPoint:p,keepCurrentModels:!x,globalOffset:p?Z:{x:0,y:0,z:0}})},(y,E)=>{console.error(`Failed to load document ${T}`,y,E)})};d.forEach((T,x)=>c(T,x===0)),e.current.addEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,v),e.current.addEventListener(Autodesk.Viewing.MODEL_ADDED_EVENT,w),e.current.addEventListener(Autodesk.Viewing.OBJECT_TREE_CREATED_EVENT,h)})}return!e.current&&r.current&&s().then(()=>console.log("viewer loaded")),()=>{var m,d,c,a,i;(m=e.current)==null||m.tearDown(),(d=e.current)==null||d.finish(),(c=e.current)==null||c.removeEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,v),(a=e.current)==null||a.removeEventListener(Autodesk.Viewing.MODEL_ADDED_EVENT,w),(i=e.current)==null||i.removeEventListener(Autodesk.Viewing.OBJECT_TREE_CREATED_EVENT,h),e.current=null,t&&t()}},[o,l,v,w,h,t]),q.jsx("div",{ref:r,style:{width:"100%",height:"100%"}})};async function U(){if(window.Autodesk)return;const o=document.createElement("script");o.src="https://developer.api.autodesk.com/modelderivative/v2/viewers/7.109.0/viewer3D.min.js",document.head.appendChild(o);const l=document.createElement("link");l.href="https://developer.api.autodesk.com/modelderivative/v2/viewers/7.109.0/style.min.css",l.rel="stylesheet",document.head.appendChild(l),await new Promise(u=>{o.onload=u})}L.__docgenInfo={description:"",methods:[],displayName:"AutodeskViewer",props:{urn:{required:!0,tsType:{name:"union",raw:"string | string[]",elements:[{name:"string"},{name:"Array",elements:[{name:"string"}],raw:"string[]"}]},description:"The URN of the model to load in Autodesk Viewer.\nExample: `dXJuOmFkc2subW9kZWw6...` or [`dXJuOmFkc2subW9kZWw6...`, `dXJuOmFkc2subW9kZWw6...`, etc]"},accessToken:{required:!0,tsType:{name:"string"},description:"The access token to use for authentication. Should be retrieved from your server."},viewableId:{required:!1,tsType:{name:"string"},description:`The ID of the viewable to load. If you don't provide this, the default viewable will be loaded'
View priority: selectedView > Default View > New Construction > Default Geometry(means Viewer method)`},useSharedCoordinateSystem:{required:!1,tsType:{name:"boolean"},description:`Whether to use a shared coordinate system for the model.
Default: false`},mappingCallback:{required:!1,tsType:{name:"signature",type:"function",raw:"(arg: any) => void",signature:{arguments:[{type:{name:"any"},name:"arg"}],return:{name:"void"}}},description:`Callback function to handle the mapping of GUIDs to DBIDs.
@param modelMapping - An object containing the model and its GUID-to-DBID mapping.`},clearCallback:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:`Callback function to clear any cached data or state.
Here I mean to clear all data that a user gets from any callback from viewer.`}}};const B={title:"Components/AutodeskViewer",component:L,parameters:{layout:"fullscreen"}},k={args:{urn:["dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLnRMT20wUTMxUmVpcWRXS3lsWUVfcHc_dmVyc2lvbj0yMA","dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLnVQb1lPaGZZVDJtRjRJcHVvS0xwTkE_dmVyc2lvbj0y"],accessToken:""}};var M,I,J;k.parameters={...k.parameters,docs:{...(M=k.parameters)==null?void 0:M.docs,source:{originalSource:`{
  args: {
    urn: ['dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLnRMT20wUTMxUmVpcWRXS3lsWUVfcHc_dmVyc2lvbj0yMA', 'dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLnVQb1lPaGZZVDJtRjRJcHVvS0xwTkE_dmVyc2lvbj0y'],
    accessToken: ''
  }
}`,...(J=(I=k.parameters)==null?void 0:I.docs)==null?void 0:J.source}}};const Y=["Default"];export{k as Default,Y as __namedExportsOrder,B as default};
