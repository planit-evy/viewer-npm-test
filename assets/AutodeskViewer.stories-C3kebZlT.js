import{r as v}from"./iframe-OA2dp3P2.js";var _={exports:{}},k={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var M;function S(){if(M)return k;M=1;var n=Symbol.for("react.transitional.element"),u=Symbol.for("react.fragment");function c(m,r,o){var s=null;if(o!==void 0&&(s=""+o),r.key!==void 0&&(s=""+r.key),"key"in r){o={};for(var p in r)p!=="key"&&(o[p]=r[p])}else o=r;return r=o.ref,{$$typeof:n,type:m,key:s,ref:r!==void 0?r:null,props:o}}return k.Fragment=u,k.jsx=c,k.jsxs=c,k}var C;function U(){return C||(C=1,_.exports=S()),_.exports}var b=U();const B=async(n,u,c)=>{var t;const m=c||n.getRoot().getDefaultGeometry();await n.downloadAecModelData();const r=m.getAecModelData(),o=r&&r.refPointTransformation;let s=(t=u.model)==null?void 0:t.getData().globalOffset;const p=o?new THREE.Vector3(o[9],o[10],o[11]):new THREE.Vector3(0,0,0),D=4e6,E=s&&THREE.Vector3.prototype.distanceToSquared.call(p,s);return(!s||E>D)&&(s=new THREE.Vector3().copy(p)),s},N=({urn:n,accessToken:u,viewableId:c,useSharedCoordinateSystem:m,mappingCallback:r,clearCallback:o,viewerEnv:s="AutodeskProduction2",viewerApi:p="derivativeV2",theme:D="light-theme"})=>{const E=v.useRef(null),t=v.useRef(null);if(typeof window>"u")return null;const L=(e,a)=>{let i=0;const d=[];let l=e.model.getData().instanceTree;function f(w){i++,l.getChildCount(w)!=0?l.enumNodeChildren(w,function(g){f(g)},!1):d.push(w),--i==0&&a(d)}e.getObjectTree(function(w){l=w,f(l.getRootId())})},T=v.useCallback(e=>{console.log("Geometry loaded",e)},[]),R=v.useCallback(e=>{console.log("Model added",e)},[]),A=v.useCallback(async e=>{L(e.target,function(a){console.log("Found "+a.length+" leaf nodes"),e.target.model.getBulkProperties2(a,{propFilter:["externalId"],categoryFilter:void 0,ignoreHidden:!0,needExternalId:!0},i=>{const d={};i.forEach(f=>{f.externalId&&(d[f.externalId]=f.dbId)}),console.log("Found leaf dbids processed");const l={model:e.model,guidsToDbids:d};console.log({model:e.model,guidsToDbids:d}),r&&r(l)},i=>{console.log("Mapping GUID to DBID error",i)})})},[]);return v.useEffect(()=>{if(!t.current){async function e(){await X();const a={env:s,api:p,accessToken:u},i={extensions:["Autodesk.DocumentBrowser"],theme:D};Autodesk.Viewing.Initializer(a,()=>{var f,w;(f=window==null?void 0:window.NOP_VIEWER)==null||f.finish(),(w=window==null?void 0:window.NOP_VIEWER)==null||w.tearDown(),t.current=new Autodesk.Viewing.GuiViewer3D(E.current,i),t.current.start();const d=Array.isArray(n)?n:[n],l=async(g,x)=>{const j=`urn:${g}`;Autodesk.Viewing.Document.load(j,async h=>{const V=h.getRoot(),q=V.findByGuid(c),F=V.getNamedViews().find(O=>O.data.name==="Default View"),G=V.getNamedViews().find(O=>O.data.name==="New Construction"),Z=V.getDefaultGeometry(),I=q||F||G||Z,H=await B(h,t.current,I);await t.current.loadDocumentNode(h,I,{applyRefPoint:m,keepCurrentModels:!x,globalOffset:m?H:{x:0,y:0,z:0}})},(h,V)=>{console.error(`Failed to load document ${g}`,h,V)})};d.forEach((g,x)=>l(g,x===0)),t.current.addEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,T),t.current.addEventListener(Autodesk.Viewing.MODEL_ADDED_EVENT,R),t.current.addEventListener(Autodesk.Viewing.OBJECT_TREE_CREATED_EVENT,A)})}e().then(()=>console.log("VIEWER LOADED",t.current,window==null?void 0:window.NOP_VIEWERS))}return()=>{var e,a,i,d,l;(e=t.current)==null||e.tearDown(),(a=t.current)==null||a.finish(),(i=t.current)==null||i.removeEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,T),(d=t.current)==null||d.removeEventListener(Autodesk.Viewing.MODEL_ADDED_EVENT,R),(l=t.current)==null||l.removeEventListener(Autodesk.Viewing.OBJECT_TREE_CREATED_EVENT,A),t.current=null,o&&o()}},[n,u,T,R,A,o]),v.useEffect(()=>{if(!E.current)return;const e=new ResizeObserver(a=>{for(const i of a)window!=null&&window.NOP_VIEWER&&window.NOP_VIEWER.resize()});return e.observe(E.current),()=>{e.disconnect()}},[]),b.jsx("div",{ref:E,style:{width:"100%",height:"100%"}})};async function X(){var c;if((c=window.Autodesk)!=null&&c.Viewing)return;if(document.getElementById("forge-viewer-script")){await new Promise(m=>{document.getElementById("forge-viewer-script").onload=m});return}const n=document.createElement("script");n.id="forge-viewer-script",n.src="https://developer.api.autodesk.com/modelderivative/v2/viewers/7.109.0/viewer3D.min.js",document.head.appendChild(n);const u=document.createElement("link");u.href="https://developer.api.autodesk.com/modelderivative/v2/viewers/7.109.0/style.min.css",u.rel="stylesheet",document.head.appendChild(u),await new Promise(m=>{n.onload=m})}N.__docgenInfo={description:"",methods:[],displayName:"AutodeskViewer",props:{urn:{required:!0,tsType:{name:"union",raw:"string | string[]",elements:[{name:"string"},{name:"Array",elements:[{name:"string"}],raw:"string[]"}]},description:"The URN of the model to load in Autodesk Viewer.\nExample: `dXJuOmFkc2subW9kZWw6...` or [`dXJuOmFkc2subW9kZWw6...`, `dXJuOmFkc2subW9kZWw6...`, etc.]"},accessToken:{required:!0,tsType:{name:"string"},description:"The access token to use for authentication. Should be retrieved from your server."},viewableId:{required:!1,tsType:{name:"string"},description:`The ID of the viewable to load. If you don't provide this, the default viewable will be loaded'
View priority: selectedView > Default View > New Construction > Default Geometry (means Viewer method)`},useSharedCoordinateSystem:{required:!1,tsType:{name:"boolean"},description:`Whether to use a shared coordinate system for the model.
Default: false`},mappingCallback:{required:!1,tsType:{name:"signature",type:"function",raw:"(arg: any) => void",signature:{arguments:[{type:{name:"any"},name:"arg"}],return:{name:"void"}}},description:`Callback function to handle the mapping of GUIDs to DBIDs.
@param modelMapping - An object containing the model and its GUID-to-DBID mapping.`},clearCallback:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:`Callback function to clear any cached data or state.
Here I mean to clear all data that a user gets from any callback from viewer.`},viewerEnv:{required:!1,tsType:{name:"union",raw:"'AutodeskProduction' | 'AutodeskProduction2'",elements:[{name:"literal",value:"'AutodeskProduction'"},{name:"literal",value:"'AutodeskProduction2'"}]},description:`The environment to use for Autodesk Viewer.
Default: 'AutodeskProduction2'`,defaultValue:{value:"'AutodeskProduction2'",computed:!1}},viewerApi:{required:!1,tsType:{name:"union",raw:"'streamingV2' | 'derivativeV2'",elements:[{name:"literal",value:"'streamingV2'"},{name:"literal",value:"'derivativeV2'"}]},description:`The API to use for Autodesk Viewer.
Default: 'derivativeV2'`,defaultValue:{value:"'derivativeV2'",computed:!1}},theme:{required:!1,tsType:{name:"union",raw:"'light-theme' | 'dark-theme'",elements:[{name:"literal",value:"'light-theme'"},{name:"literal",value:"'dark-theme'"}]},description:`The theme to use for Autodesk Viewer.
Default: 'light-theme'`,defaultValue:{value:"'light-theme'",computed:!1}}}};const Y={title:"Components/AutodeskViewer",component:N,parameters:{layout:"fullscreen"},decorators:[n=>b.jsx(v.StrictMode,{children:b.jsx(n,{})})]},y={args:{urn:["dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLnRMT20wUTMxUmVpcWRXS3lsWUVfcHc_dmVyc2lvbj0yMA","dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLnVQb1lPaGZZVDJtRjRJcHVvS0xwTkE_dmVyc2lvbj0y"],accessToken:""}};var P,J,W;y.parameters={...y.parameters,docs:{...(P=y.parameters)==null?void 0:P.docs,source:{originalSource:`{
  args: {
    urn: ['dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLnRMT20wUTMxUmVpcWRXS3lsWUVfcHc_dmVyc2lvbj0yMA', 'dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLnVQb1lPaGZZVDJtRjRJcHVvS0xwTkE_dmVyc2lvbj0y'],
    accessToken: ''
  }
}`,...(W=(J=y.parameters)==null?void 0:J.docs)==null?void 0:W.source}}};const $=["Default"];export{y as Default,$ as __namedExportsOrder,Y as default};
