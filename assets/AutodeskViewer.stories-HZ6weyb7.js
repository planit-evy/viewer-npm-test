import{r as w}from"./iframe-B86OdKfl.js";var x={exports:{}},D={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var b;function P(){if(b)return D;b=1;var t=Symbol.for("react.transitional.element"),c=Symbol.for("react.fragment");function l(u,r,n){var s=null;if(n!==void 0&&(s=""+n),r.key!==void 0&&(s=""+r.key),"key"in r){n={};for(var e in r)e!=="key"&&(n[e]=r[e])}else n=r;return r=n.ref,{$$typeof:t,type:u,key:s,ref:r!==void 0?r:null,props:n}}return D.Fragment=c,D.jsx=l,D.jsxs=l,D}var O;function Z(){return O||(O=1,x.exports=P()),x.exports}var A=Z();const H=async(t,c,l)=>{var E;const u=l||t.getRoot().getDefaultGeometry();await t.downloadAecModelData();const r=u.getAecModelData(),n=r&&r.refPointTransformation;let s=(E=c.model)==null?void 0:E.getData().globalOffset;const e=n?new THREE.Vector3(n[9],n[10],n[11]):new THREE.Vector3(0,0,0),k=4e6,v=s&&THREE.Vector3.prototype.distanceToSquared.call(e,s);return(!s||v>k)&&(s=new THREE.Vector3().copy(e)),s},J=({urn:t,accessToken:c,viewableId:l,useSharedCoordinateSystem:u,mappingCallback:r,clearCallback:n})=>{const s=w.useRef(null),e=w.useRef(null);if(typeof window>"u")return null;const k=(o,f)=>{let i=0;const d=[];let a=o.model.getData().instanceTree;function p(m){i++,a.getChildCount(m)!=0?a.enumNodeChildren(m,function(y){p(y)},!1):d.push(m),--i==0&&f(d)}o.getObjectTree(function(m){a=m,p(a.getRootId())})},v=w.useCallback(o=>{console.log("Geometry loaded",o)},[]),E=w.useCallback(o=>{console.log("Model added",o)},[]),R=w.useCallback(async o=>{k(o.target,function(f){console.log("Found "+f.length+" leaf nodes"),o.target.model.getBulkProperties2(f,{propFilter:["externalId"],categoryFilter:void 0,ignoreHidden:!0,needExternalId:!0},i=>{const d={};i.forEach(p=>{p.externalId&&(d[p.externalId]=p.dbId)}),console.log("Found leaf dbids processed");const a={model:o.model,guidsToDbids:d};console.log({model:o.model,guidsToDbids:d}),r&&r(a)},i=>{console.log("Mapping GUID to DBID error",i)})})},[]);return w.useEffect(()=>{if(!e.current){async function o(){await q();const f={env:"AutodeskProduction",accessToken:c};Autodesk.Viewing.Initializer(f,()=>{var a,p;(a=window==null?void 0:window.NOP_VIEWER)==null||a.finish(),(p=window==null?void 0:window.NOP_VIEWER)==null||p.tearDown(),e.current=new Autodesk.Viewing.GuiViewer3D(s.current),e.current.start();const i=Array.isArray(t)?t:[t],d=async(m,y)=>{const L=`urn:${m}`;Autodesk.Viewing.Document.load(L,async V=>{const g=V.getRoot(),W=g.findByGuid(l),N=g.getNamedViews().find(h=>h.data.name==="Default View"),j=g.getNamedViews().find(h=>h.data.name==="New Construction"),F=g.getDefaultGeometry(),_=W||N||j||F,G=await H(V,e.current,_);await e.current.loadDocumentNode(V,_,{applyRefPoint:u,keepCurrentModels:!y,globalOffset:u?G:{x:0,y:0,z:0}})},(V,g)=>{console.error(`Failed to load document ${m}`,V,g)})};i.forEach((m,y)=>d(m,y===0)),e.current.addEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,v),e.current.addEventListener(Autodesk.Viewing.MODEL_ADDED_EVENT,E),e.current.addEventListener(Autodesk.Viewing.OBJECT_TREE_CREATED_EVENT,R)})}o().then(()=>console.log("VIEWER LOADED",e.current,window==null?void 0:window.NOP_VIEWERS))}return()=>{var o,f,i,d,a;(o=e.current)==null||o.tearDown(),(f=e.current)==null||f.finish(),(i=e.current)==null||i.removeEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,v),(d=e.current)==null||d.removeEventListener(Autodesk.Viewing.MODEL_ADDED_EVENT,E),(a=e.current)==null||a.removeEventListener(Autodesk.Viewing.OBJECT_TREE_CREATED_EVENT,R),e.current=null,n&&n()}},[t,c,v,E,R,n]),A.jsx("div",{ref:s,style:{width:"100%",height:"100%"}})};async function q(){var l;if((l=window.Autodesk)!=null&&l.Viewing)return;if(document.getElementById("forge-viewer-script")){await new Promise(u=>{document.getElementById("forge-viewer-script").onload=u});return}const t=document.createElement("script");t.id="forge-viewer-script",t.src="https://developer.api.autodesk.com/modelderivative/v2/viewers/7.109.0/viewer3D.min.js",document.head.appendChild(t);const c=document.createElement("link");c.href="https://developer.api.autodesk.com/modelderivative/v2/viewers/7.109.0/style.min.css",c.rel="stylesheet",document.head.appendChild(c),await new Promise(u=>{t.onload=u})}J.__docgenInfo={description:"",methods:[],displayName:"AutodeskViewer",props:{urn:{required:!0,tsType:{name:"union",raw:"string | string[]",elements:[{name:"string"},{name:"Array",elements:[{name:"string"}],raw:"string[]"}]},description:"The URN of the model to load in Autodesk Viewer.\nExample: `dXJuOmFkc2subW9kZWw6...` or [`dXJuOmFkc2subW9kZWw6...`, `dXJuOmFkc2subW9kZWw6...`, etc.]"},accessToken:{required:!0,tsType:{name:"string"},description:"The access token to use for authentication. Should be retrieved from your server."},viewableId:{required:!1,tsType:{name:"string"},description:`The ID of the viewable to load. If you don't provide this, the default viewable will be loaded'
View priority: selectedView > Default View > New Construction > Default Geometry (means Viewer method)`},useSharedCoordinateSystem:{required:!1,tsType:{name:"boolean"},description:`Whether to use a shared coordinate system for the model.
Default: false`},mappingCallback:{required:!1,tsType:{name:"signature",type:"function",raw:"(arg: any) => void",signature:{arguments:[{type:{name:"any"},name:"arg"}],return:{name:"void"}}},description:`Callback function to handle the mapping of GUIDs to DBIDs.
@param modelMapping - An object containing the model and its GUID-to-DBID mapping.`},clearCallback:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:`Callback function to clear any cached data or state.
Here I mean to clear all data that a user gets from any callback from viewer.`}}};const U={title:"Components/AutodeskViewer",component:J,parameters:{layout:"fullscreen"},decorators:[t=>A.jsx(w.StrictMode,{children:A.jsx(t,{})})]},T={args:{urn:["dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLnRMT20wUTMxUmVpcWRXS3lsWUVfcHc_dmVyc2lvbj0yMA","dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLnVQb1lPaGZZVDJtRjRJcHVvS0xwTkE_dmVyc2lvbj0y"],accessToken:""}};var I,M,C;T.parameters={...T.parameters,docs:{...(I=T.parameters)==null?void 0:I.docs,source:{originalSource:`{
  args: {
    urn: ['dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLnRMT20wUTMxUmVpcWRXS3lsWUVfcHc_dmVyc2lvbj0yMA', 'dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLnVQb1lPaGZZVDJtRjRJcHVvS0xwTkE_dmVyc2lvbj0y'],
    accessToken: ''
  }
}`,...(C=(M=T.parameters)==null?void 0:M.docs)==null?void 0:C.source}}};const B=["Default"];export{T as Default,B as __namedExportsOrder,U as default};
