import{r as m}from"./iframe-C-LXqXG_.js";var b={exports:{}},h={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var C;function z(){if(C)return h;C=1;var n=Symbol.for("react.transitional.element"),i=Symbol.for("react.fragment");function d(s,e,r){var p=null;if(r!==void 0&&(p=""+r),e.key!==void 0&&(p=""+e.key),"key"in e){r={};for(var v in e)v!=="key"&&(r[v]=e[v])}else r=e;return e=r.ref,{$$typeof:n,type:s,key:p,ref:e!==void 0?e:null,props:r}}return h.Fragment=i,h.jsx=d,h.jsxs=d,h}var P;function Y(){return P||(P=1,b.exports=z()),b.exports}var O=Y();const Q=async n=>{var k;const i=n.node?n.node:n.doc.getRoot().getDefaultGeometry();await n.doc.downloadAecModelData();const d=i.getAecModelData(),s=d&&d.refPointTransformation;let e=(k=n.viewerInst.model)==null?void 0:k.getData().globalOffset;const r=s?new THREE.Vector3(s[9],s[10],s[11]):new THREE.Vector3(0,0,0),p=4e6,v=e&&THREE.Vector3.prototype.distanceToSquared.call(r,e);return(!e||v>p)&&(e=new THREE.Vector3().copy(r)),e},N=({urn:n,accessToken:i,viewableId:d,useSharedCoordinateSystem:s,mappingCallback:e,clearCallback:r,viewerEnv:p="AutodeskProduction2",viewerApi:v="derivativeV2",theme:k="light-theme",version:j="7.111.0"})=>{const y=m.useRef(null),o=m.useRef(null),[q,F]=m.useState(""),[I,G]=m.useState(!1);if(typeof window>"u")return null;const S=(t,l)=>{let a=0;const u=[];let c=t.model.getData().instanceTree;function f(w){a++,c.getChildCount(w)!=0?c.enumNodeChildren(w,function(E){f(E)},!1):u.push(w),--a==0&&l(u)}t.getObjectTree(function(w){c=w,f(c.getRootId())})},T=m.useCallback(t=>{G(!0),console.log("Geometry loaded",t)},[]),A=m.useCallback(t=>{F(`${t.type}-${t.model.id}`),console.log("Model added",t)},[]),R=m.useCallback(async t=>{S(t.target,function(l){console.log("Found "+l.length+" leaf nodes"),t.target.model.getBulkProperties2(l,{propFilter:["externalId"],categoryFilter:void 0,ignoreHidden:!0,needExternalId:!0},a=>{const u={};a.forEach(f=>{f.externalId&&(u[f.externalId]=f.dbId)}),console.log("Found leaf dbids processed");const c={model:t.model,guidsToDbids:u};console.log({model:t.model,guidsToDbids:u}),e&&e(c)},a=>{console.log("Mapping GUID to DBID error",a)})})},[]);return m.useEffect(()=>{if(!o.current){async function t(){await K(j);const l={env:p,api:v,accessToken:i},a={extensions:["Autodesk.DocumentBrowser"],theme:k};Autodesk.Viewing.Initializer(l,()=>{var f,w;(f=window==null?void 0:window.NOP_VIEWER)==null||f.finish(),(w=window==null?void 0:window.NOP_VIEWER)==null||w.tearDown(),o.current=new Autodesk.Viewing.GuiViewer3D(y.current,a),o.current.start();const u=Array.isArray(n)?n:[n],c=async(E,x)=>{const Z=`urn:${E}`;Autodesk.Viewing.Document.load(Z,async V=>{const g=V.getRoot(),H=g.findByGuid(d),U=g.getNamedViews().find(_=>_.data.name==="Default View"),B=g.getNamedViews().find(_=>_.data.name==="New Construction"),X=g.getDefaultGeometry(),M=H||U||B||X,$=await Q({doc:V,viewerInst:o.current,node:M});await o.current.loadDocumentNode(V,M,{applyRefPoint:s,keepCurrentModels:!x,globalOffset:s?$:{x:0,y:0,z:0}})},(V,g)=>{console.error(`Failed to load document ${E}`,V,g)})};u.forEach((E,x)=>c(E,x===0)),o.current.addEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,T),o.current.addEventListener(Autodesk.Viewing.MODEL_ADDED_EVENT,A),o.current.addEventListener(Autodesk.Viewing.OBJECT_TREE_CREATED_EVENT,R)})}t().then(()=>console.log("VIEWER LOADED",o.current,window==null?void 0:window.NOP_VIEWERS))}return()=>{var t,l,a,u,c;(t=o.current)==null||t.tearDown(),(l=o.current)==null||l.finish(),(a=o.current)==null||a.removeEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,T),(u=o.current)==null||u.removeEventListener(Autodesk.Viewing.MODEL_ADDED_EVENT,A),(c=o.current)==null||c.removeEventListener(Autodesk.Viewing.OBJECT_TREE_CREATED_EVENT,R),o.current=null,r&&r()}},[n,i,T,A,R,r]),m.useEffect(()=>{if(!I||!y.current)return;const t=new ResizeObserver(l=>{for(const a of l)window!=null&&window.NOP_VIEWER&&window.NOP_VIEWER.resize()});return t.observe(y.current),()=>{t.disconnect()}},[I,q]),O.jsx("div",{ref:y,style:{width:"100%",height:"100%"}})};async function K(n){var s;if((s=window.Autodesk)!=null&&s.Viewing)return;if(document.getElementById("forge-viewer-script")){await new Promise(e=>{document.getElementById("forge-viewer-script").onload=e});return}const i=document.createElement("script");i.id="forge-viewer-script",i.src=`https://developer.api.autodesk.com/modelderivative/v2/viewers/${n}/viewer3D.min.js`,document.head.appendChild(i);const d=document.createElement("link");d.href=`https://developer.api.autodesk.com/modelderivative/v2/viewers/${n}/style.min.css`,d.rel="stylesheet",document.head.appendChild(d),await new Promise(e=>{i.onload=e})}N.__docgenInfo={description:"",methods:[],displayName:"AutodeskViewer",props:{urn:{required:!0,tsType:{name:"union",raw:"string | string[]",elements:[{name:"string"},{name:"Array",elements:[{name:"string"}],raw:"string[]"}]},description:"The URN of the model to load in Autodesk Viewer.\nExample: `dXJuOmFkc2subW9kZWw6...` or [`dXJuOmFkc2subW9kZWw6...`, `dXJuOmFkc2subW9kZWw6...`, etc.]"},accessToken:{required:!0,tsType:{name:"string"},description:"The access token to use for authentication. Should be retrieved from your server."},viewableId:{required:!1,tsType:{name:"string"},description:`The ID of the viewable to load. If you don't provide this, the default viewable will be loaded'
View priority: selectedView > Default View > New Construction > Default Geometry (means Viewer method)`},useSharedCoordinateSystem:{required:!1,tsType:{name:"boolean"},description:`Whether to use a shared coordinate system for the model.
Default: false`},mappingCallback:{required:!1,tsType:{name:"signature",type:"function",raw:"(arg: any) => void",signature:{arguments:[{type:{name:"any"},name:"arg"}],return:{name:"void"}}},description:`Callback function to handle the mapping of GUIDs to DBIDs.
@param modelMapping - An object containing the model and its GUID-to-DBID mapping.`},clearCallback:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:`Callback function to clear any cached data or state.
Here I mean to clear all data that a user gets from any callback from viewer.`},viewerEnv:{required:!1,tsType:{name:"union",raw:"'AutodeskProduction' | 'AutodeskProduction2'",elements:[{name:"literal",value:"'AutodeskProduction'"},{name:"literal",value:"'AutodeskProduction2'"}]},description:`The environment to use for Autodesk Viewer.
Default: 'AutodeskProduction2'`,defaultValue:{value:"'AutodeskProduction2'",computed:!1}},viewerApi:{required:!1,tsType:{name:"union",raw:"'streamingV2' | 'derivativeV2'",elements:[{name:"literal",value:"'streamingV2'"},{name:"literal",value:"'derivativeV2'"}]},description:`The API to use for Autodesk Viewer.
Default: 'derivativeV2'`,defaultValue:{value:"'derivativeV2'",computed:!1}},theme:{required:!1,tsType:{name:"union",raw:"'light-theme' | 'dark-theme'",elements:[{name:"literal",value:"'light-theme'"},{name:"literal",value:"'dark-theme'"}]},description:`The theme to use for Autodesk Viewer.
Default: 'light-theme'`,defaultValue:{value:"'light-theme'",computed:!1}},version:{required:!1,tsType:{name:"string"},description:`The version of Autodesk Viewer to use.
Default: '7.111.0'
The latest updates could be checked here: https://aps.autodesk.com/en/docs/viewer/v7/change_history/changelog_v7/`,defaultValue:{value:"'7.111.0'",computed:!1}}}};const te={title:"Components/AutodeskViewer",component:N,parameters:{layout:"fullscreen"},decorators:[n=>O.jsx(m.StrictMode,{children:O.jsx(n,{})})]},D={args:{urn:["dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLnRMT20wUTMxUmVpcWRXS3lsWUVfcHc_dmVyc2lvbj0yMA","dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLnVQb1lPaGZZVDJtRjRJcHVvS0xwTkE_dmVyc2lvbj0y"],accessToken:""}};var J,L,W;D.parameters={...D.parameters,docs:{...(J=D.parameters)==null?void 0:J.docs,source:{originalSource:`{
  args: {
    urn: ['dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLnRMT20wUTMxUmVpcWRXS3lsWUVfcHc_dmVyc2lvbj0yMA', 'dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLnVQb1lPaGZZVDJtRjRJcHVvS0xwTkE_dmVyc2lvbj0y'],
    accessToken: ''
  }
}`,...(W=(L=D.parameters)==null?void 0:L.docs)==null?void 0:W.source}}};const ne=["Default"];export{D as Default,ne as __namedExportsOrder,te as default};
