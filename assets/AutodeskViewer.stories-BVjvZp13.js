import{r as p}from"./iframe-CJTqSt9o.js";var x={exports:{}},y={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var b;function Z(){if(b)return y;b=1;var o=Symbol.for("react.transitional.element"),c=Symbol.for("react.fragment");function u(w,r,t){var s=null;if(t!==void 0&&(s=""+t),r.key!==void 0&&(s=""+r.key),"key"in r){t={};for(var e in r)e!=="key"&&(t[e]=r[e])}else t=r;return r=t.ref,{$$typeof:o,type:w,key:s,ref:r!==void 0?r:null,props:t}}return y.Fragment=c,y.jsx=u,y.jsxs=u,y}var O;function H(){return O||(O=1,x.exports=Z()),x.exports}var A=H();const P=async(o,c,u)=>{var E;const w=u||o.getRoot().getDefaultGeometry();await o.downloadAecModelData();const r=w.getAecModelData(),t=r&&r.refPointTransformation;let s=(E=c.model)==null?void 0:E.getData().globalOffset;const e=t?new THREE.Vector3(t[9],t[10],t[11]):new THREE.Vector3(0,0,0),k=4e6,v=s&&THREE.Vector3.prototype.distanceToSquared.call(e,s);return(!s||v>k)&&(s=new THREE.Vector3().copy(e)),s},J=({urn:o,accessToken:c,viewableId:u,useSharedCoordinateSystem:w,mappingCallback:r,clearCallback:t})=>{const s=p.useRef(null),e=p.useRef(null);if(typeof window>"u")return null;const k=(n,m)=>{let i=0;const d=[];let a=n.model.getData().instanceTree;function f(l){i++,a.getChildCount(l)!=0?a.enumNodeChildren(l,function(D){f(D)},!1):d.push(l),--i==0&&m(d)}n.getObjectTree(function(l){a=l,f(a.getRootId())})},v=p.useCallback(n=>{console.log("Geometry loaded",n)},[]),E=p.useCallback(n=>{console.log("Model added",n)},[]),R=p.useCallback(async n=>{k(n.target,function(m){console.log("Found "+m.length+" leaf nodes"),n.target.model.getBulkProperties2(m,{propFilter:["externalId"],categoryFilter:void 0,ignoreHidden:!0,needExternalId:!0},i=>{const d={};i.forEach(f=>{f.externalId&&(d[f.externalId]=f.dbId)}),console.log("Found leaf dbids processed");const a={model:n.model,guidsToDbids:d};console.log({model:n.model,guidsToDbids:d}),r&&r(a)},i=>{console.log("Mapping GUID to DBID error",i)})})},[]);return p.useEffect(()=>{if(!e.current){async function n(){await q();const m={env:"AutodeskProduction",accessToken:c};Autodesk.Viewing.Initializer(m,()=>{var a,f;(a=window==null?void 0:window.NOP_VIEWER)==null||a.finish(),(f=window==null?void 0:window.NOP_VIEWER)==null||f.tearDown(),e.current=new Autodesk.Viewing.GuiViewer3D(s.current),e.current.start();const i=Array.isArray(o)?o:[o],d=async(l,D)=>{const L=`urn:${l}`;Autodesk.Viewing.Document.load(L,async V=>{const g=V.getRoot(),W=g.findByGuid(u),N=g.getNamedViews().find(h=>h.data.name==="Default View"),j=g.getNamedViews().find(h=>h.data.name==="New Construction"),F=g.getDefaultGeometry(),_=W||N||j||F,G=await P(V,e.current,_);await e.current.loadDocumentNode(V,_,{applyRefPoint:w,keepCurrentModels:!D,globalOffset:w?G:{x:0,y:0,z:0}})},(V,g)=>{console.error(`Failed to load document ${l}`,V,g)})};i.forEach((l,D)=>d(l,D===0)),e.current.addEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,v),e.current.addEventListener(Autodesk.Viewing.MODEL_ADDED_EVENT,E),e.current.addEventListener(Autodesk.Viewing.OBJECT_TREE_CREATED_EVENT,R)})}n().then(()=>console.log("VIEWER LOADED",e.current,window==null?void 0:window.NOP_VIEWERS))}return()=>{var n,m,i,d,a;e.current&&((n=e.current)==null||n.tearDown(),(m=e.current)==null||m.finish(),(i=e.current)==null||i.removeEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,v),(d=e.current)==null||d.removeEventListener(Autodesk.Viewing.MODEL_ADDED_EVENT,E),(a=e.current)==null||a.removeEventListener(Autodesk.Viewing.OBJECT_TREE_CREATED_EVENT,R),e.current=null,t&&t())}},[o,c,v,E,R,t]),A.jsx("div",{ref:s,style:{width:"100%",height:"100%"}})};async function q(){if(window.Autodesk)return;const o=document.createElement("script");o.src="https://developer.api.autodesk.com/modelderivative/v2/viewers/7.109.0/viewer3D.min.js",document.head.appendChild(o);const c=document.createElement("link");c.href="https://developer.api.autodesk.com/modelderivative/v2/viewers/7.109.0/style.min.css",c.rel="stylesheet",document.head.appendChild(c),await new Promise(u=>{o.onload=u})}J.__docgenInfo={description:"",methods:[],displayName:"AutodeskViewer",props:{urn:{required:!0,tsType:{name:"union",raw:"string | string[]",elements:[{name:"string"},{name:"Array",elements:[{name:"string"}],raw:"string[]"}]},description:"The URN of the model to load in Autodesk Viewer.\nExample: `dXJuOmFkc2subW9kZWw6...` or [`dXJuOmFkc2subW9kZWw6...`, `dXJuOmFkc2subW9kZWw6...`, etc.]"},accessToken:{required:!0,tsType:{name:"string"},description:"The access token to use for authentication. Should be retrieved from your server."},viewableId:{required:!1,tsType:{name:"string"},description:`The ID of the viewable to load. If you don't provide this, the default viewable will be loaded'
View priority: selectedView > Default View > New Construction > Default Geometry (means Viewer method)`},useSharedCoordinateSystem:{required:!1,tsType:{name:"boolean"},description:`Whether to use a shared coordinate system for the model.
Default: false`},mappingCallback:{required:!1,tsType:{name:"signature",type:"function",raw:"(arg: any) => void",signature:{arguments:[{type:{name:"any"},name:"arg"}],return:{name:"void"}}},description:`Callback function to handle the mapping of GUIDs to DBIDs.
@param modelMapping - An object containing the model and its GUID-to-DBID mapping.`},clearCallback:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:`Callback function to clear any cached data or state.
Here I mean to clear all data that a user gets from any callback from viewer.`}}};const U={title:"Components/AutodeskViewer",component:J,parameters:{layout:"fullscreen"},decorators:[o=>A.jsx(p.StrictMode,{children:A.jsx(o,{})})]},T={args:{urn:["dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLnRMT20wUTMxUmVpcWRXS3lsWUVfcHc_dmVyc2lvbj0yMA","dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLnVQb1lPaGZZVDJtRjRJcHVvS0xwTkE_dmVyc2lvbj0y"],accessToken:""}};var M,C,I;T.parameters={...T.parameters,docs:{...(M=T.parameters)==null?void 0:M.docs,source:{originalSource:`{
  args: {
    urn: ['dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLnRMT20wUTMxUmVpcWRXS3lsWUVfcHc_dmVyc2lvbj0yMA', 'dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLnVQb1lPaGZZVDJtRjRJcHVvS0xwTkE_dmVyc2lvbj0y'],
    accessToken: ''
  }
}`,...(I=(C=T.parameters)==null?void 0:C.docs)==null?void 0:I.source}}};const X=["Default"];export{T as Default,X as __namedExportsOrder,U as default};
