import{r as p}from"./iframe-DCSqznPL.js";var x={exports:{}},V={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _;function G(){if(_)return V;_=1;var n=Symbol.for("react.transitional.element"),u=Symbol.for("react.fragment");function m(w,o,t){var a=null;if(t!==void 0&&(a=""+t),o.key!==void 0&&(a=""+o.key),"key"in o){t={};for(var e in o)e!=="key"&&(t[e]=o[e])}else t=o;return o=t.ref,{$$typeof:n,type:w,key:a,ref:o!==void 0?o:null,props:t}}return V.Fragment=u,V.jsx=m,V.jsxs=m,V}var O;function Z(){return O||(O=1,x.exports=G()),x.exports}var A=Z();const H=async(n,u,m)=>{var E;const w=m||n.getRoot().getDefaultGeometry();await n.downloadAecModelData();const o=w.getAecModelData(),t=o&&o.refPointTransformation;let a=(E=u.model)==null?void 0:E.getData().globalOffset;const e=t?new THREE.Vector3(t[9],t[10],t[11]):new THREE.Vector3(0,0,0),T=4e6,v=a&&THREE.Vector3.prototype.distanceToSquared.call(e,a);return(!a||v>T)&&(a=new THREE.Vector3().copy(e)),a},I=({urn:n,accessToken:u,viewableId:m,useSharedCoordinateSystem:w,mappingCallback:o,clearCallback:t})=>{const a=p.useRef(null),e=p.useRef(null);if(typeof window>"u")return null;const T=(s,f)=>{let d=0;const c=[];let l=s.model.getData().instanceTree;function r(i){d++,l.getChildCount(i)!=0?l.enumNodeChildren(i,function(R){r(R)},!1):c.push(i),--d==0&&f(c)}s.getObjectTree(function(i){l=i,r(l.getRootId())})},v=p.useCallback(s=>{console.log("Geometry loaded",s)},[]),E=p.useCallback(s=>{console.log("Model added",s)},[]),k=p.useCallback(async s=>{T(s.target,function(f){console.log("Found "+f.length+" leaf nodes"),s.target.model.getBulkProperties2(f,{propFilter:["externalId"],categoryFilter:void 0,ignoreHidden:!0,needExternalId:!0},d=>{const c={};d.forEach(r=>{r.externalId&&(c[r.externalId]=r.dbId)}),console.log("Found leaf dbids processed");const l={model:s.model,guidsToDbids:c};console.log({model:s.model,guidsToDbids:c}),o&&o(l)},d=>{console.log("Mapping GUID to DBID error",d)})})},[]);return p.useEffect(()=>{var f;async function s(){if(e.current)return;console.log("ref",e.current),await q();const d={env:"AutodeskProduction",accessToken:u};Autodesk.Viewing.Initializer(d,()=>{e.current=new Autodesk.Viewing.GuiViewer3D(a.current),e.current.start();const c=Array.isArray(n)?n:[n],l=async(r,i)=>{const R=`urn:${r}`;Autodesk.Viewing.Document.load(R,async y=>{const g=y.getRoot(),L=g.findByGuid(m),j=g.getNamedViews().find(h=>h.data.name==="Default View"),N=g.getNamedViews().find(h=>h.data.name==="New Construction"),W=g.getDefaultGeometry(),b=L||j||N||W,F=await H(y,e.current,b);await e.current.loadDocumentNode(y,b,{applyRefPoint:w,keepCurrentModels:!i,globalOffset:w?F:{x:0,y:0,z:0}})},(y,g)=>{console.error(`Failed to load document ${r}`,y,g)})};c.forEach((r,i)=>l(r,i===0)),e.current.addEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,v),e.current.addEventListener(Autodesk.Viewing.MODEL_ADDED_EVENT,E),e.current.addEventListener(Autodesk.Viewing.OBJECT_TREE_CREATED_EVENT,k)})}return(!(window!=null&&window.NOP_VIEWER)||!((f=window==null?void 0:window.NOP_VIEWER)!=null&&f.container))&&s().then(()=>console.log("viewer loaded")),()=>{var d,c,l,r,i;(d=e.current)==null||d.tearDown(),(c=e.current)==null||c.finish(),(l=e.current)==null||l.removeEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,v),(r=e.current)==null||r.removeEventListener(Autodesk.Viewing.MODEL_ADDED_EVENT,E),(i=e.current)==null||i.removeEventListener(Autodesk.Viewing.OBJECT_TREE_CREATED_EVENT,k),e.current=null,t&&t()}},[n,u,v,E,k,t]),A.jsx("div",{ref:a,style:{width:"100%",height:"100%"}})};async function q(){if(window.Autodesk)return;const n=document.createElement("script");n.src="https://developer.api.autodesk.com/modelderivative/v2/viewers/7.109.0/viewer3D.min.js",document.head.appendChild(n);const u=document.createElement("link");u.href="https://developer.api.autodesk.com/modelderivative/v2/viewers/7.109.0/style.min.css",u.rel="stylesheet",document.head.appendChild(u),await new Promise(m=>{n.onload=m})}I.__docgenInfo={description:"",methods:[],displayName:"AutodeskViewer",props:{urn:{required:!0,tsType:{name:"union",raw:"string | string[]",elements:[{name:"string"},{name:"Array",elements:[{name:"string"}],raw:"string[]"}]},description:"The URN of the model to load in Autodesk Viewer.\nExample: `dXJuOmFkc2subW9kZWw6...` or [`dXJuOmFkc2subW9kZWw6...`, `dXJuOmFkc2subW9kZWw6...`, etc.]"},accessToken:{required:!0,tsType:{name:"string"},description:"The access token to use for authentication. Should be retrieved from your server."},viewableId:{required:!1,tsType:{name:"string"},description:`The ID of the viewable to load. If you don't provide this, the default viewable will be loaded'
View priority: selectedView > Default View > New Construction > Default Geometry (means Viewer method)`},useSharedCoordinateSystem:{required:!1,tsType:{name:"boolean"},description:`Whether to use a shared coordinate system for the model.
Default: false`},mappingCallback:{required:!1,tsType:{name:"signature",type:"function",raw:"(arg: any) => void",signature:{arguments:[{type:{name:"any"},name:"arg"}],return:{name:"void"}}},description:`Callback function to handle the mapping of GUIDs to DBIDs.
@param modelMapping - An object containing the model and its GUID-to-DBID mapping.`},clearCallback:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:`Callback function to clear any cached data or state.
Here I mean to clear all data that a user gets from any callback from viewer.`}}};const S={title:"Components/AutodeskViewer",component:I,parameters:{layout:"fullscreen"},decorators:[n=>A.jsx(p.StrictMode,{children:A.jsx(n,{})})]},D={args:{urn:["dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLnRMT20wUTMxUmVpcWRXS3lsWUVfcHc_dmVyc2lvbj0yMA","dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLnVQb1lPaGZZVDJtRjRJcHVvS0xwTkE_dmVyc2lvbj0y"],accessToken:""}};var M,C,J;D.parameters={...D.parameters,docs:{...(M=D.parameters)==null?void 0:M.docs,source:{originalSource:`{
  args: {
    urn: ['dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLnRMT20wUTMxUmVpcWRXS3lsWUVfcHc_dmVyc2lvbj0yMA', 'dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLnVQb1lPaGZZVDJtRjRJcHVvS0xwTkE_dmVyc2lvbj0y'],
    accessToken: ''
  }
}`,...(J=(C=D.parameters)==null?void 0:C.docs)==null?void 0:J.source}}};const U=["Default"];export{D as Default,U as __namedExportsOrder,S as default};
