import{r as f}from"./iframe-BeLL8HCd.js";var x={exports:{}},v={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var O;function N(){if(O)return v;O=1;var o=Symbol.for("react.transitional.element"),s=Symbol.for("react.fragment");function d(c,n,r){var u=null;if(r!==void 0&&(u=""+r),n.key!==void 0&&(u=""+n.key),"key"in n){r={};for(var l in n)l!=="key"&&(r[l]=n[l])}else r=n;return n=r.ref,{$$typeof:o,type:c,key:u,ref:n!==void 0?n:null,props:r}}return v.Fragment=s,v.jsx=d,v.jsxs=d,v}var M;function W(){return M||(M=1,x.exports=N()),x.exports}var b=W();const Z=async(o,s,d)=>{var k;const c=d||o.getRoot().getDefaultGeometry();await o.downloadAecModelData();const n=c.getAecModelData(),r=n&&n.refPointTransformation;let u=(k=s.model)==null?void 0:k.getData().globalOffset;const l=r?new THREE.Vector3(r[9],r[10],r[11]):new THREE.Vector3(0,0,0),e=4e6,V=u&&THREE.Vector3.prototype.distanceToSquared.call(l,u);return(!u||V>e)&&(u=new THREE.Vector3().copy(l)),u},E={options:{},ready:null};async function H(o){if(E.ready){if(["getAccessToken","env","api","language"].some(s=>o[s]!==E.options[s]))return Promise.reject("Cannot initialize another viewer runtime with different settings.")}else{const s=document.createElement("script");s.src="https://developer.api.autodesk.com/modelderivative/v2/viewers/7.109.0/viewer3D.min.js",document.head.appendChild(s);const d=document.createElement("link");d.href="https://developer.api.autodesk.com/modelderivative/v2/viewers/7.109.0/style.min.css",d.rel="stylesheet",document.head.appendChild(d),await new Promise(c=>{s.onload=c}),E.options={...o},E.ready=new Promise(c=>Autodesk.Viewing.Initializer(E.options,c))}return E.ready}const L=({urn:o,runtime:s,viewableId:d,useSharedCoordinateSystem:c,mappingCallback:n,clearCallback:r,theme:u})=>{const l=f.useRef(null),[e,V]=f.useState(null);if(typeof window>"u")return null;const k=(t,w)=>{let p=0;const a=[];let i=t.model.getData().instanceTree;function m(g){p++,i.getChildCount(g)!=0?i.enumNodeChildren(g,function(R){m(R)},!1):a.push(g),--p==0&&w(a)}t.getObjectTree(function(g){i=g,m(i.getRootId())})},_=f.useCallback(()=>{if(!e||!(e!=null&&e.container))return;(Array.isArray(o)?o:[o]).forEach((w,p)=>Autodesk.Viewing.Document.load("urn:"+w,async a=>{await a.downloadAecModelData();const i=a.getRoot(),m=i.findByGuid(d),g=i.getNamedViews().find(A=>A.data.name==="Default View"),R=i.getNamedViews().find(A=>A.data.name==="New Construction"),q=i.getDefaultGeometry(),C=m||g||R||q,G=await Z(a,e,C);await e.loadDocumentNode(a,C,{applyRefPoint:c,keepCurrentModels:p!==0,globalOffset:c?G:{x:0,y:0,z:0}})},(a,i,m)=>{console.error(a,i,m)}))},[o,d,c,e]),T=f.useCallback(t=>{console.log("Geometry loaded",t)},[]),D=f.useCallback(t=>{console.log("Model added",t)},[]),h=f.useCallback(async t=>{k(t.target,function(w){console.log("Found "+w.length+" leaf nodes"),t.target.model.getBulkProperties2(w,{propFilter:["externalId"],categoryFilter:void 0,ignoreHidden:!0,needExternalId:!0},p=>{const a={};p.forEach(m=>{m.externalId&&(a[m.externalId]=m.dbId)}),console.log("Found leaf dbids processed");const i={model:t.model,guidsToDbids:a};console.log({model:t.model,guidsToDbids:a}),n&&n(i)},p=>{console.log("Mapping GUID to DBID error",p)})})},[]);return f.useEffect(()=>{e||l.current&&H(s||{}).then(()=>{const t=l.current&&new Autodesk.Viewing.GuiViewer3D(l.current,{theme:u==="dark"?"dark-theme":"light-theme"});V(t)}).catch(t=>{console.error("viewer initialize error",t)})},[e,l]),f.useEffect(()=>{if(!(!e||!(e!=null&&e.container)))return e.start(),e.addEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,T),e.addEventListener(Autodesk.Viewing.MODEL_ADDED_EVENT,D),e.addEventListener(Autodesk.Viewing.OBJECT_TREE_CREATED_EVENT,h),_(),()=>{r&&r(),!(!e||!(e!=null&&e.container))&&(e.removeEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,T),e.removeEventListener(Autodesk.Viewing.MODEL_ADDED_EVENT,D),e.removeEventListener(Autodesk.Viewing.OBJECT_TREE_CREATED_EVENT,h),e.tearDown(),e.finish())}},[e,T,D,h,_]),b.jsx("div",{ref:l,style:{width:"100%",height:"100%"}})};L.__docgenInfo={description:"",methods:[],displayName:"AutodeskViewer",props:{urn:{required:!0,tsType:{name:"union",raw:"string | string[]",elements:[{name:"string"},{name:"Array",elements:[{name:"string"}],raw:"string[]"}]},description:"The URN of the model to load in Autodesk Viewer.\nExample: `dXJuOmFkc2subW9kZWw6...` or [`dXJuOmFkc2subW9kZWw6...`, `dXJuOmFkc2subW9kZWw6...`, etc.]"},runtime:{required:!0,tsType:{name:"signature",type:"object",raw:`{
  accessToken: string;
  env: string;
  api: string;
}`,signature:{properties:[{key:"accessToken",value:{name:"string",required:!0}},{key:"env",value:{name:"string",required:!0}},{key:"api",value:{name:"string",required:!0}}]}},description:`Runtime configuration for Autodesk Viewer.
accessToken: string;
 env: string;
 api: string;`},viewableId:{required:!1,tsType:{name:"string"},description:`The ID of the viewable to load. If you don't provide this, the default viewable will be loaded'
View priority: selectedView > Default View > New Construction > Default Geometry (means Viewer method)`},useSharedCoordinateSystem:{required:!1,tsType:{name:"boolean"},description:`Whether to use a shared coordinate system for the model.
Default: false`},mappingCallback:{required:!1,tsType:{name:"signature",type:"function",raw:"(arg: any) => void",signature:{arguments:[{type:{name:"any"},name:"arg"}],return:{name:"void"}}},description:`Callback function to handle the mapping of GUIDs to DBIDs.
@param modelMapping - An object containing the model and its GUID-to-DBID mapping.`},clearCallback:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:`Callback function to clear any cached data or state.
Here I mean to clear all data that a user gets from any callback from viewer.`},theme:{required:!1,tsType:{name:"union",raw:"'light' | 'dark'",elements:[{name:"literal",value:"'light'"},{name:"literal",value:"'dark'"}]},description:"The theme of the viewer."}}};const F={title:"Components/AutodeskViewer",component:L,parameters:{layout:"fullscreen"},decorators:[o=>b.jsx(f.StrictMode,{children:b.jsx(o,{})})]},y={args:{urn:["dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLnRMT20wUTMxUmVpcWRXS3lsWUVfcHc_dmVyc2lvbj0yMA","dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLnVQb1lPaGZZVDJtRjRJcHVvS0xwTkE_dmVyc2lvbj0y"],runtime:{accessToken:"",env:"AutodeskProduction2",api:"streamingV2"}}};var J,j,I;y.parameters={...y.parameters,docs:{...(J=y.parameters)==null?void 0:J.docs,source:{originalSource:`{
  args: {
    urn: ['dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLnRMT20wUTMxUmVpcWRXS3lsWUVfcHc_dmVyc2lvbj0yMA', 'dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLnVQb1lPaGZZVDJtRjRJcHVvS0xwTkE_dmVyc2lvbj0y'],
    runtime: {
      accessToken: '',
      env: 'AutodeskProduction2',
      api: 'streamingV2'
    }
  }
}`,...(I=(j=y.parameters)==null?void 0:j.docs)==null?void 0:I.source}}};const S=["Default"];export{y as Default,S as __namedExportsOrder,F as default};
