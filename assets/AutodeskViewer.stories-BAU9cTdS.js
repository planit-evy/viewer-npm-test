import{r as y}from"./iframe-kZs6Ki8h.js";var R={exports:{}},v={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var b;function W(){if(b)return v;b=1;var n=Symbol.for("react.transitional.element"),s=Symbol.for("react.fragment");function i(f,t,o){var r=null;if(o!==void 0&&(r=""+o),t.key!==void 0&&(r=""+t.key),"key"in t){o={};for(var l in t)l!=="key"&&(o[l]=t[l])}else o=t;return t=o.ref,{$$typeof:n,type:f,key:r,ref:t!==void 0?t:null,props:o}}return v.Fragment=s,v.jsx=i,v.jsxs=i,v}var A;function Z(){return A||(A=1,R.exports=W()),R.exports}var H=Z();const q=async(n,s,i)=>{var E;const f=i||n.getRoot().getDefaultGeometry();await n.downloadAecModelData();const t=f.getAecModelData(),o=t&&t.refPointTransformation;let r=(E=s.model)==null?void 0:E.getData().globalOffset;const l=o?new THREE.Vector3(o[9],o[10],o[11]):new THREE.Vector3(0,0,0),V=4e6,D=r&&THREE.Vector3.prototype.distanceToSquared.call(l,r);return(!r||D>V)&&(r=new THREE.Vector3().copy(l)),r},_=({urn:n,accessToken:s,viewableId:i,useSharedCoordinateSystem:f,mappingCallback:t,clearCallback:o})=>{const r=y.useRef(null);if(typeof window>"u")return null;const l=(e,p)=>{let c=0;const u=[];let m=e.model.getData().instanceTree;function a(d){c++,m.getChildCount(d)!=0?m.enumNodeChildren(d,function(h){a(h)},!1):u.push(d),--c==0&&p(u)}e.getObjectTree(function(d){m=d,a(m.getRootId())})},V=y.useCallback(e=>{console.log("Geometry loaded",e)},[]),D=y.useCallback(e=>{console.log("Model added",e)},[]),E=y.useCallback(async e=>{l(e.target,function(p){console.log("Found "+p.length+" leaf nodes"),e.target.model.getBulkProperties2(p,{propFilter:["externalId"],categoryFilter:void 0,ignoreHidden:!0,needExternalId:!0},c=>{const u={};c.forEach(a=>{a.externalId&&(u[a.externalId]=a.dbId)}),console.log("Found leaf dbids processed");const m={model:e.model,guidsToDbids:u};console.log({model:e.model,guidsToDbids:u}),t&&t(m)},c=>{console.log("Mapping GUID to DBID error",c)})})},[]);return y.useEffect(()=>{if(typeof window>"u")return;let e;async function p(){await L();const c={env:"AutodeskProduction",accessToken:s};Autodesk.Viewing.Initializer(c,()=>{if(e)return;e=new Autodesk.Viewing.GuiViewer3D(r.current),e.start();const u=Array.isArray(n)?n:[n],m=async(a,d)=>{const h=`urn:${a}`;Autodesk.Viewing.Document.load(h,async g=>{const w=g.getRoot(),J=w.findByGuid(i),I=w.getNamedViews().find(T=>T.data.name==="Default View"),F=w.getNamedViews().find(T=>T.data.name==="New Construction"),j=w.getDefaultGeometry(),x=J||I||F||j,G=await q(g,e,x);await e.loadDocumentNode(g,x,{applyRefPoint:f,keepCurrentModels:!d,globalOffset:f?G:{x:0,y:0,z:0}})},(g,w)=>{console.error(`Failed to load document ${a}`,g,w)})};u.forEach((a,d)=>m(a,d===0)),e.addEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,V),e.addEventListener(Autodesk.Viewing.MODEL_ADDED_EVENT,D),e.addEventListener(Autodesk.Viewing.OBJECT_TREE_CREATED_EVENT,E)})}return p().then(()=>console.log("viewer loaded")),()=>{e==null||e.finish(),o&&o()}},[n,s]),H.jsx("div",{ref:r,style:{width:"100%",height:"100%"}})};async function L(){if(window.Autodesk)return;const n=document.createElement("script");n.src="https://developer.api.autodesk.com/modelderivative/v2/viewers/7.109.0/viewer3D.min.js",document.head.appendChild(n);const s=document.createElement("link");s.href="https://developer.api.autodesk.com/modelderivative/v2/viewers/7.109.0/style.min.css",s.rel="stylesheet",document.head.appendChild(s),await new Promise(i=>{n.onload=i})}_.__docgenInfo={description:"",methods:[],displayName:"AutodeskViewer",props:{urn:{required:!0,tsType:{name:"union",raw:"string | string[]",elements:[{name:"string"},{name:"Array",elements:[{name:"string"}],raw:"string[]"}]},description:"The URN of the model to load in Autodesk Viewer.\nExample: `dXJuOmFkc2subW9kZWw6...` or [`dXJuOmFkc2subW9kZWw6...`, `dXJuOmFkc2subW9kZWw6...`, etc]"},accessToken:{required:!0,tsType:{name:"string"},description:"The access token to use for authentication. Should be retrieved from your server."},viewableId:{required:!1,tsType:{name:"string"},description:`The ID of the viewable to load. If you don't provide this, the default viewable will be loaded'
View priority: selectedView > Default View > New Construction > Default Geometry(means Viewer method)`},useSharedCoordinateSystem:{required:!1,tsType:{name:"boolean"},description:`Whether to use a shared coordinate system for the model.
Default: false`},mappingCallback:{required:!1,tsType:{name:"signature",type:"function",raw:"(arg: any) => void",signature:{arguments:[{type:{name:"any"},name:"arg"}],return:{name:"void"}}},description:`Callback function to handle the mapping of GUIDs to DBIDs.
@param modelMapping - An object containing the model and its GUID-to-DBID mapping.`},clearCallback:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:`Callback function to clear any cached data or state.
Here I mean to clear all data that a user gets from any callback from viewer.`}}};const P={title:"Components/AutodeskViewer",component:_,parameters:{layout:"fullscreen"}},k={args:{urn:["dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLnRMT20wUTMxUmVpcWRXS3lsWUVfcHc_dmVyc2lvbj0yMA","dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLnVQb1lPaGZZVDJtRjRJcHVvS0xwTkE_dmVyc2lvbj0y"],accessToken:""}};var C,M,O;k.parameters={...k.parameters,docs:{...(C=k.parameters)==null?void 0:C.docs,source:{originalSource:`{
  args: {
    urn: ['dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLnRMT20wUTMxUmVpcWRXS3lsWUVfcHc_dmVyc2lvbj0yMA', 'dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLnVQb1lPaGZZVDJtRjRJcHVvS0xwTkE_dmVyc2lvbj0y'],
    accessToken: ''
  }
}`,...(O=(M=k.parameters)==null?void 0:M.docs)==null?void 0:O.source}}};const S=["Default"];export{k as Default,S as __namedExportsOrder,P as default};
