import{r as V}from"./iframe-ttGXR_ry.js";var R={exports:{}},T={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var A;function j(){if(A)return T;A=1;var n=Symbol.for("react.transitional.element"),a=Symbol.for("react.fragment");function i(f,o,t){var r=null;if(t!==void 0&&(r=""+t),o.key!==void 0&&(r=""+o.key),"key"in o){t={};for(var l in o)l!=="key"&&(t[l]=o[l])}else t=o;return o=t.ref,{$$typeof:n,type:f,key:r,ref:o!==void 0?o:null,props:t}}return T.Fragment=a,T.jsx=i,T.jsxs=i,T}var b;function N(){return b||(b=1,R.exports=j()),R.exports}var W=N();const Z=async(n,a,i)=>{var p;const f=i||n.getRoot().getDefaultGeometry();await n.downloadAecModelData();const o=f.getAecModelData(),t=o&&o.refPointTransformation;let r=(p=a.model)==null?void 0:p.getData().globalOffset;const l=t?new THREE.Vector3(t[9],t[10],t[11]):new THREE.Vector3(0,0,0),w=4e6,y=r&&THREE.Vector3.prototype.distanceToSquared.call(l,r);return(!r||y>w)&&(r=new THREE.Vector3().copy(l)),r},M=({urn:n,accessToken:a,viewableId:i,useSharedCoordinateSystem:f,mappingCallback:o,clearCallback:t})=>{const r=V.useRef(null);if(typeof window>"u")return null;const l=(e,E)=>{let c=0;const u=[];let m=e.model.getData().instanceTree;function s(d){c++,m.getChildCount(d)!=0?m.enumNodeChildren(d,function(v){s(v)},!1):u.push(d),--c==0&&E(u)}e.getObjectTree(function(d){m=d,s(m.getRootId())})},w=V.useCallback(e=>{console.log("Geometry loaded",e)},[]),y=V.useCallback(e=>{console.log("Model added",e)},[]),p=V.useCallback(async e=>{l(e.target,function(E){console.log("Found "+E.length+" leaf nodes"),e.target.model.getBulkProperties2(E,{propFilter:["externalId"],categoryFilter:void 0,ignoreHidden:!0,needExternalId:!0},c=>{const u={};c.forEach(s=>{s.externalId&&(u[s.externalId]=s.dbId)}),console.log("Found leaf dbids processed");const m={model:e.model,guidsToDbids:u};console.log({model:e.model,guidsToDbids:u}),o&&o(m)},c=>{console.log("Mapping GUID to DBID error",c)})})},[]);return V.useEffect(()=>{if(typeof window>"u")return;let e;async function E(){await H();const c={env:"AutodeskProduction",accessToken:a};Autodesk.Viewing.Initializer(c,()=>{e=new Autodesk.Viewing.GuiViewer3D(r.current),e.start();const u=Array.isArray(n)?n:[n],m=async(s,d)=>{const v=`urn:${s}`;Autodesk.Viewing.Document.load(v,async D=>{const g=D.getRoot(),J=g.findByGuid(i),I=g.getNamedViews().find(h=>h.data.name==="Default View"),L=g.getNamedViews().find(h=>h.data.name==="New Construction"),F=g.getDefaultGeometry(),x=J||I||L||F,G=await Z(D,e,x);await e.loadDocumentNode(D,x,{applyRefPoint:f,keepCurrentModels:!d,globalOffset:f?G:{x:0,y:0,z:0}})},(D,g)=>{console.error(`Failed to load document ${s}`,D,g)})};u.forEach((s,d)=>m(s,d===0)),e.addEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,w),e.addEventListener(Autodesk.Viewing.MODEL_ADDED_EVENT,y),e.addEventListener(Autodesk.Viewing.OBJECT_TREE_CREATED_EVENT,p)})}return!e&&r.current&&E().then(()=>console.log("viewer loaded")),()=>{e==null||e.tearDown(),e==null||e.finish(),e==null||e.removeEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,w),e==null||e.removeEventListener(Autodesk.Viewing.MODEL_ADDED_EVENT,y),e==null||e.removeEventListener(Autodesk.Viewing.OBJECT_TREE_CREATED_EVENT,p),t&&t()}},[n,a,w,y,p,t]),W.jsx("div",{ref:r,style:{width:"100%",height:"100%"}})};async function H(){if(window.Autodesk)return;const n=document.createElement("script");n.src="https://developer.api.autodesk.com/modelderivative/v2/viewers/7.109.0/viewer3D.min.js",document.head.appendChild(n);const a=document.createElement("link");a.href="https://developer.api.autodesk.com/modelderivative/v2/viewers/7.109.0/style.min.css",a.rel="stylesheet",document.head.appendChild(a),await new Promise(i=>{n.onload=i})}M.__docgenInfo={description:"",methods:[],displayName:"AutodeskViewer",props:{urn:{required:!0,tsType:{name:"union",raw:"string | string[]",elements:[{name:"string"},{name:"Array",elements:[{name:"string"}],raw:"string[]"}]},description:"The URN of the model to load in Autodesk Viewer.\nExample: `dXJuOmFkc2subW9kZWw6...` or [`dXJuOmFkc2subW9kZWw6...`, `dXJuOmFkc2subW9kZWw6...`, etc]"},accessToken:{required:!0,tsType:{name:"string"},description:"The access token to use for authentication. Should be retrieved from your server."},viewableId:{required:!1,tsType:{name:"string"},description:`The ID of the viewable to load. If you don't provide this, the default viewable will be loaded'
View priority: selectedView > Default View > New Construction > Default Geometry(means Viewer method)`},useSharedCoordinateSystem:{required:!1,tsType:{name:"boolean"},description:`Whether to use a shared coordinate system for the model.
Default: false`},mappingCallback:{required:!1,tsType:{name:"signature",type:"function",raw:"(arg: any) => void",signature:{arguments:[{type:{name:"any"},name:"arg"}],return:{name:"void"}}},description:`Callback function to handle the mapping of GUIDs to DBIDs.
@param modelMapping - An object containing the model and its GUID-to-DBID mapping.`},clearCallback:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:`Callback function to clear any cached data or state.
Here I mean to clear all data that a user gets from any callback from viewer.`}}};const P={title:"Components/AutodeskViewer",component:M,parameters:{layout:"fullscreen"}},k={args:{urn:["dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLnRMT20wUTMxUmVpcWRXS3lsWUVfcHc_dmVyc2lvbj0yMA","dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLnVQb1lPaGZZVDJtRjRJcHVvS0xwTkE_dmVyc2lvbj0y"],accessToken:""}};var _,O,C;k.parameters={...k.parameters,docs:{...(_=k.parameters)==null?void 0:_.docs,source:{originalSource:`{
  args: {
    urn: ['dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLnRMT20wUTMxUmVpcWRXS3lsWUVfcHc_dmVyc2lvbj0yMA', 'dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLnVQb1lPaGZZVDJtRjRJcHVvS0xwTkE_dmVyc2lvbj0y'],
    accessToken: ''
  }
}`,...(C=(O=k.parameters)==null?void 0:O.docs)==null?void 0:C.source}}};const S=["Default"];export{k as Default,S as __namedExportsOrder,P as default};
