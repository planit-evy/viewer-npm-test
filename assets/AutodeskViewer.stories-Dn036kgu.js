import{r as y}from"./iframe-DNiWyknN.js";var D={exports:{}},E={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var h;function L(){if(h)return E;h=1;var o=Symbol.for("react.transitional.element"),a=Symbol.for("react.fragment");function i(p,t,n){var r=null;if(n!==void 0&&(r=""+n),t.key!==void 0&&(r=""+t.key),"key"in t){n={};for(var l in t)l!=="key"&&(n[l]=t[l])}else n=t;return t=n.ref,{$$typeof:o,type:p,key:r,ref:t!==void 0?t:null,props:n}}return E.Fragment=a,E.jsx=i,E.jsxs=i,E}var _;function G(){return _||(_=1,D.exports=L()),D.exports}var I=G();const Z=async(o,a,i)=>{var v;const p=i||o.getRoot().getDefaultGeometry();await o.downloadAecModelData();const t=p.getAecModelData(),n=t&&t.refPointTransformation;let r=(v=a.model)==null?void 0:v.getData().globalOffset;const l=n?new THREE.Vector3(n[9],n[10],n[11]):new THREE.Vector3(0,0,0),T=4e6,R=r&&THREE.Vector3.prototype.distanceToSquared.call(l,r);return(!r||R>T)&&(r=new THREE.Vector3().copy(l)),r},O=({urn:o,accessToken:a,viewableId:i,useSharedCoordinateSystem:p,mappingCallback:t,clearCallback:n})=>{const r=y.useRef(null);if(typeof window>"u")return null;const l=(e,f)=>{let c=0;const u=[];let m=e.model.getData().instanceTree;function s(d){c++,m.getChildCount(d)!=0?m.enumNodeChildren(d,function(k){s(k)},!1):u.push(d),--c==0&&f(u)}e.getObjectTree(function(d){m=d,s(m.getRootId())})},T=y.useCallback(e=>{console.log("Geometry loaded",e)},[]),R=y.useCallback(e=>{console.log("Model added",e)},[]),v=y.useCallback(async e=>{l(e.target,function(f){console.log("Found "+f.length+" leaf nodes"),e.target.model.getBulkProperties2(f,{propFilter:["externalId"],categoryFilter:void 0,ignoreHidden:!0,needExternalId:!0},c=>{const u={};c.forEach(s=>{s.externalId&&(u[s.externalId]=s.dbId)}),console.log("Found leaf dbids processed");const m={model:e.model,guidsToDbids:u};console.log({model:e.model,guidsToDbids:u}),t&&t(m)},c=>{console.log("Mapping GUID to DBID error",c)})})},[]);return y.useEffect(()=>{if(typeof window>"u")return;let e;async function f(){await P();const c={env:"AutodeskProduction",accessToken:a};Autodesk.Viewing.Initializer(c,()=>{e=new Autodesk.Viewing.GuiViewer3D(r.current),e.start();const u=Array.isArray(o)?o:[o],m=async(s,d)=>{const k=`urn:${s}`;Autodesk.Viewing.Document.load(k,async w=>{const g=w.getRoot(),J=g.findByGuid(i),j=g.getNamedViews().find(x=>x.data.name==="Default View"),q=g.getNamedViews().find(x=>x.data.name==="New Construction"),F=g.getDefaultGeometry(),A=J||j||q||F,H=await Z(w,e,A);await e.loadDocumentNode(w,A,{applyRefPoint:p,keepCurrentModels:!d,globalOffset:p?H:{x:0,y:0,z:0}})},(w,g)=>{console.error(`Failed to load document ${s}`,w,g)})};u.forEach((s,d)=>m(s,d===0)),e.addEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,T),e.addEventListener(Autodesk.Viewing.MODEL_ADDED_EVENT,R),e.addEventListener(Autodesk.Viewing.OBJECT_TREE_CREATED_EVENT,v)})}return f().then(()=>console.log("viewer loaded")),()=>{e==null||e.finish(),n&&n()}},[o,a]),I.jsx("div",{ref:r,style:{width:"100%",height:"100%"}})};async function P(){if(window.Autodesk)return;const o=document.createElement("script");o.src="https://developer.api.autodesk.com/modelderivative/v2/viewers/7.*/viewer3D.min.js",document.head.appendChild(o);const a=document.createElement("link");a.href="https://developer.api.autodesk.com/modelderivative/v2/viewers/7.*/style.min.css",a.rel="stylesheet",document.head.appendChild(a),await new Promise(i=>{o.onload=i})}O.__docgenInfo={description:"",methods:[],displayName:"AutodeskViewer",props:{urn:{required:!0,tsType:{name:"union",raw:"string | string[]",elements:[{name:"string"},{name:"Array",elements:[{name:"string"}],raw:"string[]"}]},description:""},accessToken:{required:!0,tsType:{name:"string"},description:""},viewableId:{required:!1,tsType:{name:"string"},description:""},useSharedCoordinateSystem:{required:!1,tsType:{name:"boolean"},description:""},mappingCallback:{required:!1,tsType:{name:"signature",type:"function",raw:"(arg: any) => void",signature:{arguments:[{type:{name:"any"},name:"arg"}],return:{name:"void"}}},description:""},clearCallback:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}};const S={title:"Components/AutodeskViewer",component:O,parameters:{layout:"fullscreen"}},V={args:{urn:["dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLnRMT20wUTMxUmVpcWRXS3lsWUVfcHc_dmVyc2lvbj0yMA","dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLnVQb1lPaGZZVDJtRjRJcHVvS0xwTkE_dmVyc2lvbj0y"],accessToken:""}};var b,M,C;V.parameters={...V.parameters,docs:{...(b=V.parameters)==null?void 0:b.docs,source:{originalSource:`{
  args: {
    urn: ['dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLnRMT20wUTMxUmVpcWRXS3lsWUVfcHc_dmVyc2lvbj0yMA', 'dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLnVQb1lPaGZZVDJtRjRJcHVvS0xwTkE_dmVyc2lvbj0y'],
    accessToken: ''
  }
}`,...(C=(M=V.parameters)==null?void 0:M.docs)==null?void 0:C.source}}};const U=["Default"];export{V as Default,U as __namedExportsOrder,S as default};
