import{r as z,a as f}from"./iframe-C6bV0sS-.js";var M={exports:{}},D={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var N;function Y(){if(N)return D;N=1;var n=z(),d=Symbol.for("react.element"),m=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,r=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,w={key:!0,ref:!0,__self:!0,__source:!0};function E(v,o,T){var i,t={},h=null,R=null;T!==void 0&&(h=""+T),o.key!==void 0&&(h=""+o.key),o.ref!==void 0&&(R=o.ref);for(i in o)s.call(o,i)&&!w.hasOwnProperty(i)&&(t[i]=o[i]);if(v&&v.defaultProps)for(i in o=v.defaultProps,o)t[i]===void 0&&(t[i]=o[i]);return{$$typeof:d,type:v,key:h,ref:R,props:t,_owner:r.current}}return D.Fragment=m,D.jsx=E,D.jsxs=E,D}var J;function Q(){return J||(J=1,M.exports=Y()),M.exports}var P=Q();const K=async n=>{var o;const d=n.node?n.node:n.doc.getRoot().getDefaultGeometry();await n.doc.downloadAecModelData();const m=d.getAecModelData(),s=m&&m.refPointTransformation;let r=(o=n.viewerInst.model)==null?void 0:o.getData().globalOffset;const w=s?new THREE.Vector3(s[9],s[10],s[11]):new THREE.Vector3(0,0,0),E=4e6,v=r&&THREE.Vector3.prototype.distanceToSquared.call(w,r);return(!r||v>E)&&(r=new THREE.Vector3().copy(w)),r},j=({urn:n,accessToken:d,viewableId:m,useSharedCoordinateSystem:s,mappingCallback:r,clearCallback:w,viewerEnv:E="AutodeskProduction2",viewerApi:v="derivativeV2",theme:o="light-theme",version:T="7.111.0"})=>{const i=f.useRef(null),t=f.useRef(null),[h,R]=f.useState(""),[C,F]=f.useState(!1);if(typeof window>"u")return null;const G=(e,u)=>{let a=0;const l=[];let c=e.model.getData().instanceTree;function p(g){a++,c.getChildCount(g)!=0?c.enumNodeChildren(g,function(y){p(y)},!1):l.push(g),--a==0&&u(l)}e.getObjectTree(function(g){c=g,p(c.getRootId())})},A=f.useCallback(e=>{F(!0),console.log("Geometry loaded",e)},[]),b=f.useCallback(e=>{R(`${e.type}-${e.model.id}`),console.log("Model added",e)},[]),O=f.useCallback(async e=>{G(e.target,function(u){console.log("Found "+u.length+" leaf nodes"),e.target.model.getBulkProperties2(u,{propFilter:["externalId"],categoryFilter:void 0,ignoreHidden:!0,needExternalId:!0},a=>{const l={};a.forEach(p=>{p.externalId&&(l[p.externalId]=p.dbId)}),console.log("Found leaf dbids processed");const c={model:e.model,guidsToDbids:l};console.log({model:e.model,guidsToDbids:l}),r&&r(c)},a=>{console.log("Mapping GUID to DBID error",a)})})},[]);return f.useEffect(()=>{if(!t.current){async function e(){await ee(T);const u={env:E,api:v,accessToken:d},a={extensions:["Autodesk.DocumentBrowser"],theme:o};Autodesk.Viewing.Initializer(u,()=>{var p,g;(p=window==null?void 0:window.NOP_VIEWER)==null||p.finish(),(g=window==null?void 0:window.NOP_VIEWER)==null||g.tearDown(),t.current=new Autodesk.Viewing.GuiViewer3D(i.current,a),t.current.start();const l=Array.isArray(n)?n:[n],c=async(y,x)=>{const Z=`urn:${y}`;Autodesk.Viewing.Document.load(Z,async k=>{const V=k.getRoot(),H=V.findByGuid(m),U=V.getNamedViews().find(I=>I.data.name==="Default View"),B=V.getNamedViews().find(I=>I.data.name==="New Construction"),X=V.getDefaultGeometry(),L=H||U||B||X,$=await K({doc:k,viewerInst:t.current,node:L});await t.current.loadDocumentNode(k,L,{applyRefPoint:s,keepCurrentModels:!x,globalOffset:s?$:{x:0,y:0,z:0}})},(k,V)=>{console.error(`Failed to load document ${y}`,k,V)})};l.forEach((y,x)=>c(y,x===0)),t.current.addEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,A),t.current.addEventListener(Autodesk.Viewing.MODEL_ADDED_EVENT,b),t.current.addEventListener(Autodesk.Viewing.OBJECT_TREE_CREATED_EVENT,O)})}e().then(()=>console.log("VIEWER LOADED",t.current,window==null?void 0:window.NOP_VIEWERS))}return()=>{var e,u,a,l,c;(e=t.current)==null||e.tearDown(),(u=t.current)==null||u.finish(),(a=t.current)==null||a.removeEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,A),(l=t.current)==null||l.removeEventListener(Autodesk.Viewing.MODEL_ADDED_EVENT,b),(c=t.current)==null||c.removeEventListener(Autodesk.Viewing.OBJECT_TREE_CREATED_EVENT,O),t.current=null,w&&w()}},[n,d,A,b,O,w]),f.useEffect(()=>{if(!C||!i.current)return;const e=new ResizeObserver(u=>{for(const a of u)window!=null&&window.NOP_VIEWER&&window.NOP_VIEWER.resize()});return e.observe(i.current),()=>{e.disconnect()}},[C,h]),P.jsx("div",{ref:i,style:{width:"100%",height:"100%"}})};async function ee(n){var s;if((s=window.Autodesk)!=null&&s.Viewing)return;if(document.getElementById("forge-viewer-script")){await new Promise(r=>{document.getElementById("forge-viewer-script").onload=r});return}const d=document.createElement("script");d.id="forge-viewer-script",d.src=`https://developer.api.autodesk.com/modelderivative/v2/viewers/${n}/viewer3D.min.js`,document.head.appendChild(d);const m=document.createElement("link");m.href=`https://developer.api.autodesk.com/modelderivative/v2/viewers/${n}/style.min.css`,m.rel="stylesheet",document.head.appendChild(m),await new Promise(r=>{d.onload=r})}j.__docgenInfo={description:"",methods:[],displayName:"AutodeskViewer",props:{urn:{required:!0,tsType:{name:"union",raw:"string | string[]",elements:[{name:"string"},{name:"Array",elements:[{name:"string"}],raw:"string[]"}]},description:"The URN of the model to load in Autodesk Viewer.\nExample: `dXJuOmFkc2subW9kZWw6...` or [`dXJuOmFkc2subW9kZWw6...`, `dXJuOmFkc2subW9kZWw6...`, etc.]"},accessToken:{required:!0,tsType:{name:"string"},description:"The access token to use for authentication. Should be retrieved from your server."},viewableId:{required:!1,tsType:{name:"string"},description:`The ID of the viewable to load. If you don't provide this, the default viewable will be loaded'
View priority: selectedView > Default View > New Construction > Default Geometry (means Viewer method)`},useSharedCoordinateSystem:{required:!1,tsType:{name:"boolean"},description:`Whether to use a shared coordinate system for the model.
Default: false`},mappingCallback:{required:!1,tsType:{name:"signature",type:"function",raw:"(arg: any) => void",signature:{arguments:[{type:{name:"any"},name:"arg"}],return:{name:"void"}}},description:`Callback function to handle the mapping of GUIDs to DBIDs.
@param modelMapping - An object containing the model and its GUID-to-DBID mapping.`},clearCallback:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:`Callback function to clear any cached data or state.
Here I mean to clear all data that a user gets from any callback from viewer.`},viewerEnv:{required:!1,tsType:{name:"union",raw:"'AutodeskProduction' | 'AutodeskProduction2'",elements:[{name:"literal",value:"'AutodeskProduction'"},{name:"literal",value:"'AutodeskProduction2'"}]},description:`The environment to use for Autodesk Viewer.
Default: 'AutodeskProduction2'`,defaultValue:{value:"'AutodeskProduction2'",computed:!1}},viewerApi:{required:!1,tsType:{name:"union",raw:"'streamingV2' | 'derivativeV2'",elements:[{name:"literal",value:"'streamingV2'"},{name:"literal",value:"'derivativeV2'"}]},description:`The API to use for Autodesk Viewer.
Default: 'derivativeV2'`,defaultValue:{value:"'derivativeV2'",computed:!1}},theme:{required:!1,tsType:{name:"union",raw:"'light-theme' | 'dark-theme'",elements:[{name:"literal",value:"'light-theme'"},{name:"literal",value:"'dark-theme'"}]},description:`The theme to use for Autodesk Viewer.
Default: 'light-theme'`,defaultValue:{value:"'light-theme'",computed:!1}},version:{required:!1,tsType:{name:"string"},description:`The version of Autodesk Viewer to use.
Default: '7.111.0'
The latest updates could be checked here: https://aps.autodesk.com/en/docs/viewer/v7/change_history/changelog_v7/`,defaultValue:{value:"'7.111.0'",computed:!1}}}};const ne={title:"Components/AutodeskViewer",component:j,parameters:{layout:"fullscreen"},decorators:[n=>P.jsx(f.StrictMode,{children:P.jsx(n,{})})]},_={args:{urn:["dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLnRMT20wUTMxUmVpcWRXS3lsWUVfcHc_dmVyc2lvbj0yMA","dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLnVQb1lPaGZZVDJtRjRJcHVvS0xwTkE_dmVyc2lvbj0y"],accessToken:""}};var W,q,S;_.parameters={..._.parameters,docs:{...(W=_.parameters)==null?void 0:W.docs,source:{originalSource:`{
  args: {
    urn: ['dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLnRMT20wUTMxUmVpcWRXS3lsWUVfcHc_dmVyc2lvbj0yMA', 'dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLnVQb1lPaGZZVDJtRjRJcHVvS0xwTkE_dmVyc2lvbj0y'],
    accessToken: ''
  }
}`,...(S=(q=_.parameters)==null?void 0:q.docs)==null?void 0:S.source}}};const oe=["Default"];export{_ as Default,oe as __namedExportsOrder,ne as default};
